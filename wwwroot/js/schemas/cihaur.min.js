"use strict";const whiteBasemap=L.tileLayer("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/w8AAwAB/3cwcakAAAAASUVORK5CYII="),map=L.map("map",{center:[-7,109.5],zoom:10,maxZoom:13,minZoom:10,layers:[whiteBasemap]});var circleBgTransparent={color:"black",fillColor:"transparent",fillOpacity:0,weight:1},circleBgWhite={color:"black",fillColor:"white",fillOpacity:1,weight:1},circleBgBlack={color:"black",fillColor:"black",fillOpacity:1,weight:1},bangunanPembagiList=[],bangunanSadapList=[],boxPetakList=[],SkemaSidareja={init:function(){!function(){const e=document.getElementById("filter-date"),t=$("#filter-date").flatpickr({locale:"id",defaultDate:new Date,altInput:!0,altFormat:"j F Y",dateFormat:"Y-m-d"});function a(e,t){const a=new Date(e);return a.setDate(a.getDate()+t),a}$("#btn-prev").on("click",function(){const n=a(t.selectedDates[0]||new Date,-1);t.setDate(n),e.dispatchEvent(new Event("change"))}),$("#btn-next").on("click",function(){const n=a(t.selectedDates[0]||new Date,1);t.setDate(n),e.dispatchEvent(new Event("change"))}),$("#filter-date").on("change",function(){getSchemaData($(this).val())})}(),function(){map.attributionControl.setPrefix(!1),map.attributionControl.addAttribution("DI. Manganti Versi: R4 (Update 16 Juli 2024)");var e=L.control({position:"topright"});e.onAdd=function(e){var t=L.DomUtil.create("div","legend");return t.innerHTML='\n            <div>\n              <table id="table-legenda" style="width: 100%; border-collapse: collapse;">\n                <thead>\n                  <tr>\n                    <th colspan="2">KETERANGAN :</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <tr>\n                    <td class="text-center"><img src="/images/icon-bangunan-sadap.png" style="height: 20px; margin-right: 5px;"></td>\n                    <td>Bangunan Pengambil/Sadap</td>\n                  </tr>\n                  <tr>\n                    <td class="text-center"><img src="/images/icon-bangunan-pembagi.png" style="height: 20px; margin-right: 5px;"></td>\n                    <td>Bangunan Pembagi</td>\n                  </tr>\n                  <tr>\n                    <td class="text-center"><span style="vertical-align: middle;border: 2px solid rgba(26,188,156);display: inline-block;width: 1rem;height: 1rem;border-radius: 2px; margin-right: 5px;"></span></td>\n                    <td><span style="vertical-align: middle;">Golongan A</span></td>\n                  </tr>\n                  <tr>\n                    <td class="text-center"><span style="vertical-align: middle;border: 2px solid #027DFC;display: inline-block;width: 1rem;height: 1rem;border-radius: 2px; margin-right: 5px;"></span></td>\n                    <td><span style="vertical-align: middle;">Golongan B</span></td>\n                  </tr>\n                  <tr>\n                    <td class="text-center"><span style="vertical-align: middle;border: 2px solid #F509F2;display: inline-block;width: 1rem;height: 1rem;border-radius: 2px; margin-right: 5px;"></span></td>\n                    <td><span style="vertical-align: middle;">Golongan C</span></td>\n                  </tr>\n                  <tr>\n                    <td class="text-center fw-bold">QK</td>\n                    <td>Debit Kebutuhan</td>\n                  </tr>\n                  <tr>\n                    <td class="text-center text-primary fw-bold">QA</td>\n                    <td>Debit Aktual</td>\n                  </tr>\n                  <tr>\n                    <td class="text-center text-warning fw-bold">QR</td>\n                    <td>\n                        <div class="d-flex align-items-start flex-column">\n                            <div>Debit Rekomendasi</div>\n                            <div>(Hasil Rekomendasi AI)</div>\n                        </div>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          ',t},e.addTo(map)}(),function(){const e=[-7.125,108.93],t=[-6.98,108.93],a=[-6.68,108.93],n=[-6.55,109.3],o=[-6.55,109.65],r=[-6.55,109.9],i=[-6.55,110.3],d=[-6.55,110.6],l=[-6.55,110.9],s=[-6.55,111.2],c=[-6.55,111.5],g=[-6.55,111.8],p=[-6.55,112],b=[e[0],109.08],m=[e[0],109.26],u=[e[0],109.44],f=[e[0],109.62],h=[e[0],109.8],B=[-6.85,n[1]],k=[-6.98,n[1]],x=[-6.85,g[1]],S=[-7,g[1]];generateBoxPetak("9d05c2bc-5924-403d-9195-6c30516d5ca0","Ch 27 Ki",[p,[-6.45,p[1]]],"top"),generateBoxPetak("ba4ec83a-a600-416f-a599-1a81273b32d6","Cw 2 Ka",[S,[S[0],111.72]],"left"),generateBangunanSadap("B.Cw 2","centerright",[g,S],0),generateBoxPetak("13210921-967b-4bdc-9490-a8a7c33132bb","Cw 1 Ka",[x,[x[0],111.72]],"left"),generateBangunanSadap("B.Cw 1","centerright",[g,x],0),generateBoxPetak("be135653-0e70-4322-96f1-672c82bb4a3f","Ch 26 Ka",[g,[-6.65,111.95]],"bottom"),generateBoxPetak("1111b9da-59f7-4590-be94-0249c3a94ba6","Ch 25 Ka",[c,[-6.63,c[1]]],"bottom"),generateBoxPetak("72740a1e-8f67-43ec-9925-2f0340c4129f","Ch 24 Ka",[s,[-6.63,s[1]]],"bottom"),generateBoxPetak("e028c976-3cbf-4c8a-8668-5f7b31850ae1","Ch 23 Ka",[l,[-6.63,l[1]]],"bottom"),generateBoxPetak("0fb63ac6-79c5-4947-a2ba-b88d838e93c7","Ch 22 Ka",[d,[-6.63,d[1]]],"bottom"),generateBoxPetak("938e9429-883d-4b81-b703-ca4906e20971","Ch 21 Ka",[i,[-6.63,i[1]]],"bottom"),generateBoxPetak("856a6944-f7fa-41e5-9d13-62dedf4a3faf","Ch 20 Ka",[r,[-6.63,r[1]]],"bottom"),generateBoxPetak("2cb54ac1-5e76-456b-87ef-c024b35e7f8a","Ch 19 Ka",[o,[-6.63,o[1]]],"bottom"),generateBoxPetak("ea80ef9a-70db-450b-8a8c-73e9126f8a44","Kc 2 Ki",[k,[k[0],109.4]],"right"),generateBangunanSadap("B.Kc 2","centerleft",[n,k],0),generateBoxPetak("b24a7e0a-70c7-41f8-9ebe-582fff3ced85","Kc 1 Ka",[B,[B[0],109.25]],"left"),generateBangunanSadap("B.Kc 1","centerright",[n,B],0),generateBoxPetak("063e7557-ee1b-43da-afa6-38d8f81e2a13","Ch 18 Ka",[n,[-6.68,109.43]],"bottom"),generateBoxPetak("1fcae390-0b0e-4ac1-bfca-fc3fa5e9177d","Ch 17 Ka",[a,[a[0],109]],"right"),generateBoxPetak("33fb18ff-1bf1-44bd-bcc8-bba6f6d1d5ed","Ch 16 Ka",[t,[t[0],109]],"right"),generateTextSaluranSekunder("SAL.SEK.SIDAREJA",[-7.165,109.44],0),generateBoxPetak("c7c1ae72-c5f5-4485-bb13-886785a919c7","Sr 5 Ka",[h,[h[0]-.06,h[1]]],"bottom"),generateBoxPetak("0402022b-6f4c-48c8-998e-28f813d2732e","Sr 4 Ka",[f,[f[0]-.06,f[1]]],"bottom"),generateBoxPetak("2ae66f2e-5a6f-4a7a-be5f-79905adb7339","Sr 3 Ka",[u,[u[0]-.06,u[1]]],"bottom"),generateBoxPetak("ff5f37d4-9b2c-47af-9800-f90f807de06c","Sr 2 Ka",[m,[m[0]-.06,m[1]]],"bottom"),generateBoxPetak("1fcae390-0b0e-4ac1-bfca-fc3fa5e9167d","Sr 1 Ka",[b,[b[0]-.06,b[1]]],"bottom"),generateBangunanSadap("B.Sr 4","topcenter",[e,h],0),generateBangunanSadap("B.Sr 4","topcenter",[e,f],0),generateBangunanSadap("B.Sr 3","topcenter",[e,u],0),generateBangunanSadap("B.Sr 2","topcenter",[e,m],0),generateBangunanSadap("B.Sr 1","topcenter",[e,b],0),generateBangunanPembagiDanSadap("B.Ch. 27","topright",[g,p]),generateBangunanPembagi("B.Ch. 26","topcenter",[c,g]),generateBangunanPembagiDanSadap("B.Ch. 25","topcenter",[s,c]),generateBangunanPembagiDanSadap("B.Ch. 24","topcenter",[l,s]),generateBangunanPembagiDanSadap("B.Ch. 23","topcenter",[d,l]),generateTextSaluranPrimer("SALURAN INDUK CIHAUR",[-6.6,110.1],0),generateBangunanPembagiDanSadap("B.Ch. 22","topcenter",[i,d]),generateBangunanPembagiDanSadap("B.Ch. 21 (BC.II - IX)","topcenter",[r,i]),generateBangunanPembagiDanSadap("B.Ch. 20","topcenter",[o,r]),generateBangunanPembagiDanSadap("B.Ch. 19","topcenter",[n,o]),generateTextSaluranSekunder("SAL.SEK.KUNCI",[-6.7,109.27],270),generateBangunanPembagi("B.Ch. 18","topcenter",[a,[-6.55,108.93],[-6.55,109.3]]),generateBangunanPembagiDanSadap("B.Ch. 17","left",[e,a]),generateBangunanPembagiDanSadap("B.Ch. 16","left",[e,t]),generateBangunanPembagi("B.Ch. 15","left",[[-7.325,108.77],[-7.325,108.93],e]),generateTextSaluranPrimer("SALURAN INDUK CIHAUR",[-7.05,108.8],270)}()}};function updateOffsetBangunanPembagi(e,t){var a=[0,0];a=10===t?[-15,0]:11===t?[-25,0]:12===t?[-45,0]:13===t?[-75,0]:[-55,0];const n=e.getTooltip(),o=n.getContent(),r=n.options.direction||"auto";"top"==r&&(a=[0,-10]),e.unbindTooltip(),e.bindTooltip(o,{permanent:!0,direction:r,className:"transparent-tooltip",offset:a}).openTooltip()}function setResponsiveSkema(){const e=map.getZoom();var t=e+10;document.querySelectorAll(".bs-title").forEach(e=>{e.style.fontSize=`${t}px`}),bangunanPembagiList.forEach(t=>{updateOffsetBangunanPembagi(t,e)})}function generateBangunanPembagi(e,t,a){L.polyline(a,{color:"black",weight:1}).addTo(map);const n=`<div class="bs-title">${e}</div>`;var o=L.circle(a[a.length-1],1e3,circleBgWhite).addTo(map);L.circle(a[a.length-1],380,circleBgBlack).addTo(map);var r=[-15,0],i="left";"topcenter"==t&&(i="top",r=[0,-10]),o.bindTooltip(n,{permanent:!0,direction:i,className:"transparent-tooltip",offset:r}).openTooltip(),bangunanPembagiList.push(o)}function generateBangunanPembagiDanSadap(e,t,a){L.polyline(a,{color:"black",weight:1}).addTo(map);const n=`<div class="bs-title">${e}</div>`;var o=L.circle(a[a.length-1],250,circleBgWhite).addTo(map),r=[-15,0],i="left";"topcenter"==t?(i="top",r=[0,-10]):"topright"==t&&(i="top",r=[35,-10]),o.bindTooltip(n,{permanent:!0,direction:i,className:"transparent-tooltip",offset:r}).openTooltip(),bangunanPembagiList.push(o)}function generateBangunanSadap(e,t,a,n){L.polyline(a,{color:"black",weight:1}).addTo(map);const o=`<div class="bangunan-sadap-title" style="transform: rotate(${n}deg);white-space: nowrap;">${e}</div>`;var r=L.circle(a[a.length-1],250,circleBgWhite).addTo(map),i=[0,0],d="center";"topcenter"==t?(d="top",i=[0,-10]):"topleft"==t?(d="top",i=[-10,-10]):"topright"==t?(d="top",i=[10,-10]):"bottomcenter"==t?(d="bottom",i=[0,10]):"bottomright"==t?(d="bottom",i=[8,10]):"bottomleft"==t?(d="bottom",i=[-8,10]):"centerright"==t?(d="right",i=[10,0]):"centerleft"==t&&(d="left",i=[-10,0]),r.bindTooltip(o,{permanent:!0,direction:d,className:"transparent-tooltip",offset:i}).openTooltip(),bangunanSadapList.push(r)}function generateBangunanSadapDanPembagi(e,t,a,n){L.polyline(a,{color:"black",weight:1}).addTo(map);const o=`<div class="bangunan-sadap-title" style="transform: rotate(${n}deg);white-space: nowrap;">${e}</div>`;var r=L.circle(a[a.length-1],1e3,circleBgWhite).addTo(map);L.circle(a[a.length-1],380,circleBgBlack).addTo(map);var i=[0,0],d="center";"topcenter"==t?(d="top",i=[3,-15]):"topleft"==t?(d="top",i=[-10,-10]):"topright"==t?(d="top",i=[10,-10]):"bottomcenter"==t?(d="bottom",i=[0,10]):"bottomright"==t&&(d="bottom",i=[8,15]),r.bindTooltip(o,{permanent:!0,direction:d,className:"transparent-tooltip",offset:i}).openTooltip(),bangunanSadapList.push(r)}function generateBoxPetak(e,t,a,n,o){const r=L.polyline(a,{color:"black",weight:1}).addTo(map),i=`\n    <div class="box-petak">\n        <table id="petak-${e}">\n          <thead>\n            <tr>\n                <th class="text-center" colspan="2">${t}</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr>\n                <td class="luas-petak">\n                  A= <strong>-</strong>\n                </td>\n                <td>\n                  <span class="debit-kebutuhan text-dark">QK= <strong>-</strong></span>\n                  </br>\n                  <span class="debit-aktual text-primary">QA= <strong>-</strong></span>\n                  </br>\n                  <span class="debit-rekomendasi text-warning">QR= <strong>-</strong></span>\n                </td>\n            </tr>\n          </tbody>\n        </table>\n    </div>\n  `,d=r.getLatLngs()[1];r.bindTooltip(i,{permanent:!0,direction:n,className:"transparent-tooltip",offset:[0,0]}).openTooltip(d),boxPetakList.push(r)}function generateTextSaluranPrimer(e,t,a){L.marker(t,{icon:L.divIcon({className:"text-saluran-primer",iconSize:[100,40],html:`<div style="transform: rotate(${a}deg);">${e}</div>`})}).addTo(map)}function generateTextSaluranSekunder(e,t,a){L.marker(t,{icon:L.divIcon({className:"text-saluran-sekunder",iconSize:[100,40],html:`<div style="transform: rotate(${a}deg);">${e}</div>`})}).addTo(map)}jQuery(document).ready(function(){SkemaSidareja.init(),getSchemaData(getValueById("filter-date"))}),map.on("zoomend",setResponsiveSkema),setResponsiveSkema();const inputField=document.getElementById("filter-date"),prevButton=document.getElementById("btn-prev"),nextButton=document.getElementById("btn-next");function disableElements(){prevButton.disabled=!0,nextButton.disabled=!0,inputField.disabled=!0,inputField.classList.add("disabled")}function enableElements(){prevButton.disabled=!1,nextButton.disabled=!1,inputField.disabled=!1,inputField.classList.remove("disabled")}function getSchemaData(e){disableElements(),$(".box-petak tbody").html('<tr><td class="text-center" colspan="2"><img src="/images/loading.gif" /></td></tr>'),getData(`/Schema/GetSchemaDataByDate/${e}`).then(e=>{let t=e.data;if(200==t.metaData.code){var a="A= <strong>-</strong>",n="QK= <strong>-</strong>",o="QA= <strong>-</strong>",r="QR= <strong>-</strong>";$(".box-petak tbody").html(`\n        <tr>\n          <td class="luas-petak">\n            ${a}\n          </td>\n          <td>\n            <span class="debit-kebutuhan text-dark">${n}</span>\n            </br>\n            <span class="debit-aktual text-primary">${o}</span>\n            </br>\n            <span class="debit-rekomendasi text-warning">${r}</span>\n          </td>\n        </tr>\n      `),$.each(t.response,function(e,t){null!=t.luas&&(a=`A= ${formatNumber(t.luas)} Ha`),null!=t.debit_kebutuhan&&(n=`QK= ${formatNumber(t.debit_kebutuhan)} lt/dt`),null!=t.debit_aktual&&(o=`QA= ${formatNumber(t.debit_aktual)} lt/dt`),null!=t.debit_rekomendasi&&(r=`QR= ${formatNumber(t.debit_rekomendasi)} lt/dt`),$(`#petak-${t.id} tbody`).html(`\n          <tr>\n            <td class="luas-petak">\n              ${a}\n            </td>\n            <td>\n              <span class="debit-kebutuhan text-dark">${n}</span>\n              </br>\n              <span class="debit-aktual text-primary">${o}</span>\n              </br>\n              <span class="debit-rekomendasi text-warning">${r}</span>\n            </td>\n          </tr>\n        `)}),enableElements()}}).catch(e=>{enableElements();let t=e.response.data;t.success||console.log(t.message)})}function formatNumber(e){let t=parseFloat(e.toFixed(2)).toString();return t.endsWith(".00")&&(t=t.slice(0,-3)),t}