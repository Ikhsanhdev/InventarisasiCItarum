"use strict";const whiteBasemap=L.tileLayer("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/w8AAwAB/3cwcakAAAAASUVORK5CYII="),map=L.map("map",{center:[-8.6,106.65],zoom:10,maxZoom:13,minZoom:10,layers:[whiteBasemap]});var circleBgTransparent={color:"black",fillColor:"transparent",fillOpacity:0,weight:1},circleBgWhite={color:"black",fillColor:"white",fillOpacity:1,weight:1},circleBgBlack={color:"black",fillColor:"black",fillOpacity:1,weight:1},bangunanPembagiList=[],bangunanSadapList=[],boxPetakList=[],box=[],SkemaLaksel={init:function(){!function(){const t=document.getElementById("filter-date"),e=$("#filter-date").flatpickr({locale:"id",defaultDate:new Date,altInput:!0,altFormat:"j F Y",dateFormat:"Y-m-d"});function a(t,e){const a=new Date(t);return a.setDate(a.getDate()+e),a}$("#btn-prev").on("click",function(){const n=a(e.selectedDates[0]||new Date,-1);e.setDate(n),t.dispatchEvent(new Event("change"))}),$("#btn-next").on("click",function(){const n=a(e.selectedDates[0]||new Date,1);e.setDate(n),t.dispatchEvent(new Event("change"))}),$("#filter-date").on("change",function(){getSchemaData($(this).val())})}(),function(){map.attributionControl.setPrefix(!1),map.attributionControl.addAttribution("DI. Manganti Skema Laksel Versi: R4 (Update 16 Juli 2024) | App Versi 2.1 (Update 13 Agustus 2024)");var t=L.control({position:"topright"});t.onAdd=function(t){var e=L.DomUtil.create("div","legend");return e.innerHTML='\n            <div>\n              <table id="table-legenda" style="width: 100%; border-collapse: collapse;">\n                <thead>\n                  <tr>\n                    <th colspan="2">KETERANGAN :</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  <tr>\n                    <td class="text-center"><img src="/images/icon-bangunan-sadap.png" style="height: 20px; margin-right: 5px;"></td>\n                    <td>Bangunan Pengambil/Sadap</td>\n                  </tr>\n                  <tr>\n                    <td class="text-center"><img src="/images/icon-bangunan-pembagi.png" style="height: 20px; margin-right: 5px;"></td>\n                    <td>Bangunan Pembagi</td>\n                  </tr>\n                  <tr>\n                    <td class="text-center"><span style="vertical-align: middle;border: 2px solid rgba(26,188,156);display: inline-block;width: 1rem;height: 1rem;border-radius: 2px; margin-right: 5px;"></span></td>\n                    <td><span style="vertical-align: middle;">Golongan A</span></td>\n                  </tr>\n                  <tr>\n                    <td class="text-center"><span style="vertical-align: middle;border: 2px solid #027DFC;display: inline-block;width: 1rem;height: 1rem;border-radius: 2px; margin-right: 5px;"></span></td>\n                    <td><span style="vertical-align: middle;">Golongan B</span></td>\n                  </tr>\n                  <tr>\n                    <td class="text-center"><span style="vertical-align: middle;border: 2px solid #F509F2;display: inline-block;width: 1rem;height: 1rem;border-radius: 2px; margin-right: 5px;"></span></td>\n                    <td><span style="vertical-align: middle;">Golongan C</span></td>\n                  </tr>\n                  <tr>\n                    <td class="text-center fw-bold">QK</td>\n                    <td>Debit Kebutuhan</td>\n                  </tr>\n                  <tr>\n                    <td class="text-center text-primary fw-bold">QA</td>\n                    <td>Debit Aktual</td>\n                  </tr>\n                  <tr>\n                    <td class="text-center text-warning fw-bold">QR</td>\n                    <td>\n                        <div class="d-flex align-items-start flex-column">\n                            <div>Debit Rekomendasi</div>\n                            <div>(Hasil Rekomendasi AI)</div>\n                        </div>\n                    </td>\n                  </tr>\n                </tbody>\n              </table>\n            </div>\n          ',e},t.addTo(map)}(),function(){const t=[-8.6,106.65],e=[-8.6,106.65],a=[e[0]-.2,e[1]],n=[a[0]-.15,a[1]],i=[n[0]-.2,n[1]],o=[i[0]-.2,i[1]],r=[i[0]-.1,i[1]],l=[r[0]-.22,r[1]+.08],s=[l[0]-.04,l[1]+.06],d=[l[0]-.08,l[1]+.15],c=[d[0]-.02,d[1]+.1],p=[d[0]-.03,d[1]+.2],g=[p[0],p[1]],m=[a[0],a[1]-.25];generateTextSaluranSekunder("SAL. SIDARAHAYU",[m[0]+.04,m[1]+.1],0),generateTextSaluranPrimer("SAL. PRIMER MANGANTI",[i[0]+.2,i[1]+.1],90),generateTextSaluranPrimer("BENDUNGAN MANGANTI",[e[0]+.15,e[1]-.05],0),generateLineCustom([[e[0]+.12,e[1]-.2],[e[0]+.12,106.8]]),generateTextSaluranPrimer("S.CITANDU",[e[0]+.05,e[1]-.05],0),AliranMasuk([t[0]+.075,t[1]-.2],0),generateLineCustom([[e[0],e[1]-.2],[-8.6,106.8]]),generateLineCustom([[l[0],l[1]-.1],[l[0]+.12,l[1]+.02]]),generateTextSaluranPrimer("S.CISEEL",[l[0]-.05,e[1]-.02],313),AliranMasuk([l[0]+.06,l[1]-.03],345),generateLineCustom([[l[0]-.08,l[1]-.08],[l[0]+.05,l[1]+.05]]),generateBangunanPembagi("BMT.0","topright",[e,[-8.6,106.65]]),generateBangunanPembagi("BMT.1","topright",[e,a]),generateBox("4.540.00 Ha","7.515 m3/s","3.502  m",[m,[m[0]+.08,m[1]+.08]],"top"),generateBangunanPembagiDanSadap("BMT.2","topright",[a,n]),generateBoxPetak("6622f2b4-52b3-4038-9245-94542093be49","MT.22 Ka",[n,[n[0],n[1]-.02]],"left",""),generateBangunanPembagiDanSadap("BMT.3","topright",[a,i]),generateBoxPetak("1e52ea36-f585-4c9f-a26d-21e632eb9bfd","MT.33 Ka",[i,[i[0],i[1]-.02]],"left",""),generateBangunanPembagiDanSadap("BMT.4","topright",[i,r]),generateBoxPetak("1853a814-f7ae-4397-b9c7-c7a0de356e58","MT.4 Ki",[r,[r[0],r[1]-.02]],"left",""),generateBangunanPembagiDanSadap("BMT.5","topright",[i,o]),generateBoxPetak("f980295c-6296-43f4-8df4-48608a662407","MT.5 Ka",[o,[o[0],o[1]-.02]],"left",""),generateBangunanPembagi("BMT.6","topright",[o,l]),generateBangunanPembagiDanSadap("BMT.7","topright",[l,s]),generateBoxPetak("082a87f4-4a79-475a-8c87-c40f88bba7f3","MT.7 Ki",[s,[s[0]+.18,s[1]]],"top",""),generateBangunanPembagiDanSadap("BMT.8","topright",[s,d]),generateBoxPetak("5e82325e-787d-42c7-950e-a5bc096a5d51","MT.8 Ki",[d,[d[0]+.14,d[1]]],"top",""),generateBangunanPembagiDanSadap("BMT.9","topright",[d,c]),generateBoxPetak("cdcbbbce-2cee-48b9-aeff-8a9844f003cc","MT.9 Ki",[c,[c[0]+.06,c[1]]],"top",""),generateBangunanPembagi("BBL.0","topright",[c,g])}()}};function isDateInRange(t){const e=new Date("2024-08-24"),a=new Date("2024-09-05"),n=new Date(t);return n.setHours(0,0,0,0),n>=e&&n<=a}function updateOffsetBangunanPembagi(t,e){var a=[0,0];a=10===e?[-15,0]:11===e?[-25,0]:12===e?[-45,0]:13===e?[-75,0]:[-55,0];const n=t.getTooltip(),i=n.getContent(),o=n.options.direction||"auto";"top"==o&&(a=[0,-10]),t.unbindTooltip(),t.bindTooltip(i,{permanent:!0,direction:o,className:"transparent-tooltip",offset:a}).openTooltip()}function setResponsiveSkema(){const t=map.getZoom();var e=t+10;document.querySelectorAll(".bs-title").forEach(t=>{t.style.fontSize=`${e}px`}),bangunanPembagiList.forEach(e=>{updateOffsetBangunanPembagi(e,t)})}function generateBangunanPembagi(t,e,a){L.polyline(a,{color:"black",weight:1}).addTo(map);const n=`<div class="bs-title">${t}</div>`;var i=L.circle(a[a.length-1],1e3,circleBgWhite).addTo(map);L.circle(a[a.length-1],380,circleBgBlack).addTo(map);var o=[-15,0],r="left";"topcenter"==e?(r="top",o=[0,-10]):"topleft"==e?(r="top",o=[-10,-10]):"topright"==e?(r="top",o=[10,-10]):"bottomcenter"==e?(r="bottom",o=[0,10]):"bottomright"==e&&(r="bottom",o=[8,15]),i.bindTooltip(n,{permanent:!0,direction:r,className:"transparent-tooltip",offset:o}).openTooltip(),bangunanPembagiList.push(i)}function generateLineCustom(t){L.polyline(t,{color:"black",weight:1}).addTo(map)}function generateBangunanPembagiDanSadap(t,e,a){L.polyline(a,{color:"black",weight:1}).addTo(map);const n=`<div class="bs-title">${t}</div>`;var i=L.circle(a[a.length-1],250,circleBgWhite).addTo(map),o=[-15,0],r="left";"topcenter"==e?(r="top",o=[0,-10]):"topright"==e&&(r="top",o=[35,-10]),i.bindTooltip(n,{permanent:!0,direction:r,className:"transparent-tooltip",offset:o}).openTooltip(),bangunanPembagiList.push(i)}function generateBangunanSadap(t,e,a,n){L.polyline(a,{color:"black",weight:1}).addTo(map);const i=`<div class="bangunan-sadap-title" style="transform: rotate(${n}deg);white-space: nowrap;">${t}</div>`;var o=L.circle(a[a.length-1],250,circleBgWhite).addTo(map),r=[0,0],l="center";"topcenter"==e?(l="top",r=[0,-10]):"topleft"==e?(l="top",r=[-10,-10]):"topright"==e?(l="top",r=[10,-10]):"bottomcenter"==e?(l="bottom",r=[0,10]):"bottomright"==e?(l="bottom",r=[8,10]):"bottomleft"==e?(l="bottom",r=[-8,10]):"centerright"==e?(l="right",r=[10,0]):"centerleft"==e&&(l="left",r=[-10,0]),o.bindTooltip(i,{permanent:!0,direction:l,className:"transparent-tooltip",offset:r}).openTooltip(),bangunanSadapList.push(o)}function generateBangunanSadapDanPembagi(t,e,a,n){L.polyline(a,{color:"black",weight:1}).addTo(map);const i=`<div class="bangunan-sadap-title" style="transform: rotate(${n}deg);white-space: nowrap;">${t}</div>`;var o=L.circle(a[a.length-1],1e3,circleBgWhite).addTo(map);L.circle(a[a.length-1],380,circleBgBlack).addTo(map);var r=[0,0],l="center";"topcenter"==e?(l="top",r=[3,-15]):"topleft"==e?(l="top",r=[-10,-10]):"topright"==e?(l="top",r=[10,-10]):"bottomcenter"==e?(l="bottom",r=[0,10]):"bottomright"==e&&(l="bottom",r=[8,15]),o.bindTooltip(i,{permanent:!0,direction:l,className:"transparent-tooltip",offset:r}).openTooltip(),bangunanSadapList.push(o)}function generateBox(t,e,a,n,i){const o=L.polyline(n,{color:"gray",weight:1,opacity:0}).addTo(map),r=`\n    <div class="border-box">\n        <table>\n          <tbody>\n            <tr>\n                <td>\n                  <span class="text-dark">A = ${t}</span>\n                  </br>\n                  <span class="text-dark">Q = ${e}</span>\n                  </br>\n                  <span class="text-dark">L = ${a}</span>\n                </td>\n            </tr>\n          </tbody>\n        </table>\n    </div>\n  `,l=o.getLatLngs()[1];o.bindTooltip(r,{permanent:!0,direction:i,className:"transparent-tooltip",offset:[0,0]}).openTooltip(l),box.push(o)}jQuery(document).ready(function(){SkemaLaksel.init(),getSchemaData(getValueById("filter-date"))}),map.on("zoomend",setResponsiveSkema),setResponsiveSkema();var initAliranMasuk=function(){L.marker([-7.15,108.8],{icon:L.divIcon({className:"panah-aliran",html:'<img src="/images/panah-aliran3.png" style="width: 59px; height: 15px;transform: rotate(130deg);background-color: transparent;border-color:#fff;" />'})}).addTo(map);L.polyline([[-7.1,108.8],[-7.235,108.77]],{color:"black",weight:1}).addTo(map),L.circle([-7.1,108.8],380,circleBgTransparent).addTo(map),L.circle([-7.1,108.8],830,circleBgTransparent).addTo(map).bindTooltip('<div class="text-sumber-aliran">BENDUNG MANGANTI</div>',{permanent:!0,direction:"right",className:"transparent-tooltip",offset:[10,1]}).openTooltip()};function AliranMasuk(t,e){L.marker(t,{icon:L.divIcon({className:"panah-aliran",html:`<img src="/images/panah-aliran3.png" style="width: 59px; height: 15px; transform: rotate(${e}deg); background-color: transparent; border-color:#fff;" />`})}).addTo(map)}function generateBoxPetak(t,e,a,n,i){const o=L.polyline(a,{color:"black",weight:1}).addTo(map),r=`\n    <div class="box-petak ${i}" id="${t}-petak">\n        <table id="petak-${t}">\n          <thead>\n            <tr>\n                <th class="text-center" colspan="2">${e}</th>\n            </tr>\n          </thead>\n          <tbody>\n            <tr>\n                <td class="luas-petak">\n                  A= <strong>-</strong>\n                </td>\n                <td>\n                  <span class="debit-kebutuhan text-dark">QK= <strong>-</strong></span>\n                  </br>\n                  <span class="debit-aktual text-primary">QA= <strong>-</strong></span>\n                  </br>\n                  <span class="debit-rekomendasi text-warning">QR= <strong>-</strong></span>\n                </td>\n            </tr>\n          </tbody>\n        </table>\n    </div>\n  `,l=o.getLatLngs()[1];o.bindTooltip(r,{permanent:!0,direction:n,className:"transparent-tooltip",offset:[0,0]}).openTooltip(l),boxPetakList.push(o)}function generateTextSaluranPrimer(t,e,a){L.marker(e,{icon:L.divIcon({className:"text-saluran-primer",iconSize:[100,40],html:`<div style="transform: rotate(${a}deg);">${t}</div>`})}).addTo(map)}function generateTextSaluranSekunder(t,e,a){L.marker(e,{icon:L.divIcon({className:"text-saluran-sekunder",iconSize:[100,40],html:`<div style="transform: rotate(${a}deg);">${t}</div>`})}).addTo(map)}const inputField=document.getElementById("filter-date"),prevButton=document.getElementById("btn-prev"),nextButton=document.getElementById("btn-next");function disableElements(){prevButton.disabled=!0,nextButton.disabled=!0,inputField.disabled=!0,inputField.classList.add("disabled")}function enableElements(){prevButton.disabled=!1,nextButton.disabled=!1,inputField.disabled=!1,inputField.classList.remove("disabled")}function getSchemaData(t){disableElements(),$(".box-petak tbody").html('<tr><td class="text-center" colspan="2"><img src="/images/loading.gif" /></td></tr>'),getData(`/Schema/GetSchemaDataByDate/${t}`).then(e=>{let a=e.data;if(200==a.metaData.code){var n="A= <strong>-</strong>",i="QK= <strong>-</strong>",o="QA= <strong>-</strong>",r="QR= <strong>-</strong>";$(".box-petak tbody").html(`\n        <tr>\n          <td class="luas-petak">\n            ${n}\n          </td>\n          <td>\n            <span class="debit-kebutuhan text-dark">${i}</span>\n            </br>\n            <span class="debit-aktual text-primary">${o}</span>\n            </br>\n            <span class="debit-rekomendasi text-warning">${r}</span>\n          </td>\n        </tr>\n      `),$.each(a.response,function(e,a){null!=a.luas&&(n=`A= ${formatNumber(a.luas)} Ha`),null!=a.debit_kebutuhan&&(i=isDateInRange(t)?"QK= 0 lt/dt":`QK= ${formatNumber(a.debit_kebutuhan)} lt/dt`),null!=a.debit_aktual&&(o=`QA= ${formatNumber(a.debit_aktual)} lt/dt`),null!=a.debit_rekomendasi&&(r=isDateInRange(t)?"QR= 0 lt/dt":`QR= ${formatNumber(a.debit_rekomendasi)} lt/dt`),$(`#petak-${a.id} tbody`).html(`\n          <tr>\n            <td class="luas-petak">\n              ${n}\n            </td>\n            <td>\n              <span class="debit-kebutuhan text-dark">${i}</span>\n              </br>\n              <span class="debit-aktual text-primary">${o}</span>\n              </br>\n              <span class="debit-rekomendasi text-warning">${r}</span>\n            </td>\n          </tr>\n        `)}),enableElements()}}).catch(t=>{enableElements();let e=t.response.data;e.success||console.log(e.message)})}function formatNumber(t){let e=parseFloat(t.toFixed(2)).toString();return e.endsWith(".00")&&(e=e.slice(0,-3)),e}