"use strict";var dataTelemetriAwlr,dataTelemetriArr;const NOW_YEAR=(new Date).getFullYear(),STATION_ID=$("#station-id").val(),STATION_TYPE=$("#station-type").val(),FIRST_TAB=$(".tab-data")[0];let URL,WAKTU;function fetchData(a){let t=generateUrl(a);"data-pos"==a&&GetDataPos(t,STATION_ID),"data-telemetri"==a&&loadPartialView(a),"data-grafik"==a&&loadPartialView(a)}function generateUrl(a){switch(a){case"data-pos":return`/StationDetail/GetDataPos?StationId=${STATION_ID}`;case"data-telemetri":return`/StationDetail/GetDataTelemetri?StationId=${STATION_ID}`;case"data-grafik":return`/StationDetail/GetDataGrafik?StationId=${STATION_ID}`}}function GetDataPos(a,t){getData(a,t).then(a=>{var t=a.data;$("#pos-name").text(t.name),"AWLR"==t.type?$("#pos-desc").text("Pos Duga Air"):"ARR"==t.type?$("#pos-desc").text("Pos Curah Hujan"):$("#pos-desc").text("-"),$("#detail_no_register").text(null==t.noRegister?"-":t.noRegister),$("#detail_elevation").text(null==t.elevation?"-":t.elevation),$("#detail_device_id").text(null==t.devices[0].deviceId?"-":t.devices[0].deviceId),$("#detail_device_merk").text(null==t.devices[0].brand.name?"-":t.devices[0].brand.name),$("#detail_wilayah_sungai").text(null==t.watershed?"-":t.watershed[0].riverArea.name),$("#detail_das").text(null==t.watershed?"-":t.watershed[0].name),$("#detail_built_by").text(null==t.builtBy?"-":t.builtBy),$("#detail_built_year").text(null==t.builtYear?"-":t.builtYear),$("#detail_renov_by").text(null==t.renovationBy?"-":t.renovationBy),$("#detail_renov_year").text(null==t.renovationYear?"-":t.renovationYear),$("#detail_note").text(null==t.note?"-":t.note),$("#detail_coordinate").text(`${t.latitude} , ${t.longitude}`),$("#detail_province").text(null==t.province?"-":t.province[0].name),$("#detail_district").text(null==t.district?"-":t.district[0].name),$("#detail_village").text(null==t.village?"-":t.village[0].name),$("#detail_city").text(null==t.regency?"-":t.regency[0].name)})}function loadDataGrafik(a,t,e){$.ajax({url:`/StationDetail/GetDataGrafik?id=${STATION_ID}&waktu=${t}&periode=${e}`,type:"GET",dataType:"json",async:!0,success:function(t){generateGrafik(a,e,t)},error:function(a,t,e){console.error("Error: "+t+" - "+e)}})}function generateGrafik(a,t,e){let i=generateData(e.dataGrafik),r=null==e.dataTma!=null,n=null==e.dataTma!=null,l=null==e.dataTma?null:e.dataSiaga.siaga1>e.dataTma.tmaMax?e.dataSiaga.siaga1:e.dataTma.tmaMax,o="";if(2==t.split("-").length){o=moment(t,"YYYY-MM").locale("id").format("MMMM YYYY")}else{o=moment(t,"YYYY-MM-DD").locale("id").format("DD MMMM YYYY")}"AWLR"==a.toUpperCase()&&Highcharts.stockChart("container",{title:{text:"Grafik Tinggi Muka Air"},subtitle:{text:`Per ${o}`},yAxis:{title:{text:"Tinggi Muka Air (m)"},max:null,min:null,opposite:!1,labels:{style:{align:"left"}},minorGridLineWidth:0,gridLineWidth:0,alternateGridColor:null,plotBands:r?[{from:e.dataSiaga.siaga3,to:e.dataSiaga.siaga2-.01,color:"rgba(255, 218, 79, 0.3)",label:{text:"Siaga 3",style:{color:"#606060"}}},{from:e.dataSiaga.siaga2,to:e.dataSiaga.siaga1-.01,color:"rgba(255, 166, 0, 0.3)",label:{text:"Siaga 2",style:{color:"#606060"}}},{from:e.dataSiaga.siaga2,to:l,color:"rgba(239, 83, 80, 0.3)",label:{text:"Siaga 1",style:{color:"#606060"}}}]:null},xAxis:{gapGridLineWidth:0},plotOptions:{series:{marker:{enabled:!0,radius:4,symbol:"circle"},lineWidth:2,animation:!1},line:{}},series:[{name:"TMA",type:"area",data:i,lineColor:"#2B7FB4",tooltip:{valueDecimals:2},fillOpacity:.1,fillColor:n?{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,Highcharts.getOptions().colors[0]],[1,Highcharts.color(Highcharts.getOptions().colors[0]).setOpacity(0).get("rgba")]]}:Highcharts.getOptions().colors[0],threshold:null}]}),"ARR"==a.toUpperCase()&&Highcharts.stockChart("container",{chart:{alignTicks:!1},rangeSelector:{selected:1},title:{text:"Grafik Curah Hujan"},subtitle:{text:`Per ${o}`},yAxis:{title:{text:"Curah Hujan (mm)"},opposite:!1},series:[{type:"column",name:"CH",data:i}]})}function loadPartialView(a){$(".loading-spinner").css("display","block");let t="",e="";switch(a){case"data-pos":t=`/StationDetail/LoadPartialView?ToData=${a}&Type=${STATION_TYPE}`;break;case"data-telemetri":e="tab-data-telemetri",t=`/StationDetail/LoadPartialView?ToData=${a}&Type=${STATION_TYPE}`;break;case"data-grafik":e="tab-data-grafik",t=`/StationDetail/LoadPartialView?ToData=${a}&Type=${STATION_TYPE}`}$.ajax({url:t,type:"GET",dataType:"html",success:function(a){$(".loading-spinner").css("display","none"),$(`#${e}`).html(a)},error:function(){alert("An error occurred while loading the partial view.")}})}function loadDatePicker(a,t){if("data-grafik"==a)switch($("#periode-grafik").datepicker("destroy"),t){case"menit":case"jam":$("#periode-grafik").datepicker({format:"yyyy-mm-dd",autoclose:!0,todayHighlight:!0,endDate:"{{ date('Y-m-d') }}",orientation:"bottom"}),$("#periode-grafik").datepicker("update","{{ date('Y-m-d') }}");break;case"hari":$("#periode-grafik").datepicker({format:"yyyy-mm",viewMode:"months",minViewMode:"months",endDate:"{{ date('Y-m') }}",autoclose:!0,todayHighlight:!0,orientation:"bottom"}),$("#periode-grafik").datepicker("update","{{ date('Y-m') }}")}if("data-telemetri"==a)switch($("#periode").datepicker("destroy"),t){case"menit":case"jam":$("#periode").datepicker({format:"yyyy-mm-dd",autoclose:!0,todayHighlight:!0,endDate:"{{ date('Y-m-d') }}",orientation:"bottom"}),$("#periode").datepicker("update","{{ date('Y-m-d') }}");break;case"hari":$("#periode").datepicker({format:"yyyy-mm",viewMode:"months",minViewMode:"months",endDate:"{{ date('Y-m') }}",autoclose:!0,todayHighlight:!0,orientation:"bottom"}),$("#periode").datepicker("update","{{ date('Y-m') }}")}}function loadDataTelemetriAwlr(a){$("#table-telemetri").DataTable().destroy(),dataTelemetriAwlr=$("#table-telemetri").DataTable({dom:"rti",paging:!1,order:[[0,"desc"]],ajax:{url:a,type:"POST",contentType:"application/json",dataType:"JSON",data:function(a){return JSON.stringify(a)}},columns:[{data:"tanggal"},{data:"jam",render:function(a,t,e){return""==a||null==a||null==a?"":a.replace(".",":")}},{data:"tma"},{data:"perubahanStatus",render:function(a,t,e){return null==a||""==a||"constant"==a?"":"decrease"==a?`<span><i class="mdi mdi-arrow-down-circle text-success font-weight-bold"\n                                style="font-size: 15px;"></i> ${e.perubahanValue} ${e.satuanPerubahan}</span>`:"increase"==a?`<span><i class="mdi mdi-arrow-up-circle text-danger font-weight-bold"\n                                style="font-size: 15px;"></i> ${e.perubahanValue} ${e.satuanPerubahan}</span>`:void 0}},{data:"debit"},{data:"status",render:function(a,t,e){if(""==a||null==a||null==a)return"";switch(a){case"Normal":return`<span class="badge bg-soft-success text-success">${a}</span>`;case"Siaga 1":return`<span class="badge bg-soft-danger text-danger">${a}</span>`;case"Siaga 2":return`<span class="badge bg-soft-success text-success">${a}</span>`;case"Siaga 3":return`<span class="badge bg-soft-warning text-warning">${a}</span>`}}}]})}function loadDataTelemetriArr(a,t){$("#table-telemetri").DataTable().destroy(),"MENIT"==t.toUpperCase()&&(dataTelemetriArr=$("#table-telemetri").DataTable({dom:"rti",paging:!1,order:[[1,"desc"]],ajax:{url:a,type:"POST",contentType:"application/json",dataType:"JSON",data:function(a){return JSON.stringify(a)}},columns:[{data:null},{data:"tanggal"},{data:"jam",render:function(a,t,e){return""==a||null==a||null==a?"":a.split(".").join(":")}},{data:"ch"}]})),"JAM"==t.toUpperCase()&&(dataTelemetriArr=$("#table-telemetri").DataTable({dom:"rti",paging:!1,order:[[1,"desc"]],ajax:{url:a,type:"POST",contentType:"application/json",dataType:"JSON",data:function(a){return JSON.stringify(a)}},columns:[{data:null},{data:"tanggal"},{data:"jam",render:function(a,t,e){return""==a||null==a||null==a?"":a.replace(".",":")}},{data:"ch",name:"ch"},{data:"intensitas",name:"intensitas"}]})),"HARI"==t.toUpperCase()&&(dataTelemetriArr=$("#table-telemetri").DataTable({dom:"rti",paging:!1,order:[[1,"desc"]],ajax:{url:a,type:"POST",contentType:"application/json",dataType:"JSON",data:function(a){return JSON.stringify(a)}},columns:[{data:null},{data:"tanggal"},{data:"ch",name:"ch"},{data:"intensitas",name:"intensitas"}]})),dataTelemetriArr.on("draw.dt",function(){var a=dataTelemetriArr.page.info();dataTelemetriArr.column(0,{search:"applied",order:"applied",page:"applied"}).nodes().each(function(t,e){t.innerHTML=e+1+a.start})})}function generateData(a){if(null==a||null==a||0==a.length)return[];let t=[];for(let e=0;e<a.length;e++){let i=[];i.push(new Date(a[e].date).getTime()),i.push(a[e].value),t.push(i)}return t}function loadPartialTableArr(a){$.ajax({url:"/StationDetail/LoadPartialTableArr",type:"GET",dataType:"html",data:{waktu:a},success:function(a){$("#parent-table").html(a)},error:function(){alert("An error occurred while loading the partial view.")}})}$(document).ready(function(){FIRST_TAB.click()}),$(".tab-data").on("click",function(){fetchData($(this).data("id"))});