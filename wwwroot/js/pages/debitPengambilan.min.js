"use strict";var dataTablePengambilan,dataPengambilan={init:function(){$(".parsley-validation").parsley(),$("#search-pengambilan-table").keyup(function(){dataTablePengambilan.search($(this).val()).draw()}),$("#length-pengambilan-table").change(function(){dataTablePengambilan.page.len($(this).val()).draw()}),(dataTablePengambilan=$("#table-pengambilan").DataTable({processing:!0,serverSide:!0,dom:"tipr",order:[[2,"asc"]],ajax:{url:"/DebitBendung/GetDataDebitPengambilan",type:"POST",dataType:"JSON"},columns:[{data:null},{data:"tanggal",name:"Tanggal",render:function(a){return formatDate(a,"tanggal")}},{data:"nilai",name:"Nilai",render:function(a){return a?`<span class="ketersediaan-color fw-semibold text-center d-block">${parseFloat(a).toFixed(2)}</span>`:'<span class="text-center d-block">-</span>'}},{data:"satuan",name:"Satuan",className:"text-center"},{data:"update",name:"Update",render:function(a){return formatDate(a,"update")}},{className:"text-nowrap",render:function(a,e,t){return`<button type="button" class="btn btn-xs btn-success me-1 rounded-2 action-button" data-id="${t.id}" onclick="createEditDebit(this, event)"><i class="mdi mdi-square-edit-outline me-1"></i>Edit</button>\n                            <button type="button" class="btn btn-xs btn-danger rounded-2" data-id="${t.id}" onclick="deleteDebit(this, event)"><i class="mdi mdi-delete me-1"></i>Delete</button>`}}],columnDefs:[{targets:0,searchable:!1,orderable:!1,width:"9%",className:"text-center"},{targets:-1,searchable:!1,orderable:!1,width:"18%",className:"text-center"}],language:{paginate:{previous:"<i class='mdi mdi-chevron-left'>",next:"<i class='mdi mdi-chevron-right'>"}},drawCallback:function(){$(".dataTables_paginate > .pagination").addClass("pagination-rounded")}})).on("draw.dt",function(){var a=dataTablePengambilan.page.info();dataTablePengambilan.column(0,{search:"applied",order:"applied",page:"applied"}).nodes().each(function(e,t){e.innerHTML=t+1+a.start})})}};function formatDate(a,e){const t=new Date(a),n=t.getDate(),i=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"][t.getMonth()],l=t.getFullYear(),r=String(t.getHours()).padStart(2,"0"),d=String(t.getMinutes()).padStart(2,"0");return"tanggal"===e?`${n} ${i} ${l}`:"update"===e?`${n} ${i} ${l} ${r}:${d}`:void 0}jQuery(document).ready(function(){dataPengambilan.init(),$("#input-pengambilan").on("submit",function(a){a.preventDefault();var e=$(this).find('button[type="submit"]'),t=e.text();e.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Loading...'),$.ajax({url:"/DebitBendung/SavePengambilan",type:"POST",data:$(this).serialize(),success:function(a){200==a.code?($("#input-pengambilan")[0].reset(),dataTablePengambilan.ajax.reload(null,!1)):alert("There was an error submitting the form.")},error:function(a,e,t){console.error("Submission failed:",t),alert("An error occurred while submitting the form.")},complete:function(){e.prop("disabled",!1).html(t)}})})}),window.createEditDebit=((a,e)=>{e.preventDefault();var t=$(a).html();beforeLoadingButton($(a));var n=$(a).data("id"),i=new FormData;i.append("Id",n),postData("/DebitBendung/CreateEditPengambilan",i).then(e=>{let n=e.data;$("#modalCreateEditDebit .modal-content").html(n),$("#modalCreateEditDebit").modal("show"),afterLoadingButton($(a),t)})}),window.updatePengambilan=((a,e)=>{e.preventDefault();var t=$(a).find("button[type=submit]");if($(a).parsley().validate(),$(a).parsley().isValid()){beforeLoadingButton(t);var n=new FormData;n.append("Id",getValueById("Id")),n.append("Nilai",getValueById("Nilai")),n.append("Satuan",getValueById("Satuan")),postData("/DebitBendung/UpdatePengambilan",n).then(a=>{let e=a.data;200==e.code?(console.log("tanggal: ",tanggal),console.log("id: ",n.append("Id",getValueById("Id"))),$("#modalCreateEditDebit").modal("hide"),dataTablePengambilan.ajax.reload(null,!1)):showMessage("error","Gagal!",e.message),afterLoadingButton(t)}).catch(a=>{console.log(a),afterLoadingButton(t)})}}),window.deleteDebit=((a,e)=>{e.preventDefault();var t=$(a).data("id");Swal.fire({title:"Hapus Petak",text:"Anda yakin untuk menghapus Petak tersebut ?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal",showLoaderOnConfirm:!0,preConfirm:()=>deleteData("/DebitBendung/DeletePengambilan/"+t).then(a=>{if(200!==a.status)throw new Error(a.statusText);return a}).catch(a=>{Swal.showValidationMessage(`Request failed: ${a}`)}),allowOutsideClick:()=>!Swal.isLoading()}).then(a=>{console.log(a),a.isConfirmed&&(200==a.value.data.code?dataTablePengambilan.ajax.reload(null,!1):showMessage("error","Failed",a.value.data.message))})});