"use strict";var dataTableReport;let periode,TYPE="AWLR",posName={AWLR:"POS DUGA AIR",ARR:"POS CURAH HUJAN",AWS:"POS KLIMATOLOGI",WQMS:"POS KUALITAS AIR",AWLR_ARR:"POS DUGA AIR & CURAH HUJAN","V-Notch":"Pos V-Notch Weir"};function generateDownloadButton(e,t){return`<div class="button-list d-flex">\n                           <button onclick="downloadData(this,event);" type="button" class="btn btn-success waves-effect waves-light btn-sm" data-id="${e}" data-type="${t}" data-file="excel"><i class="fe-download me-1"></i> Excel</button>\n                            <button onclick="downloadData(this,event);"  type="button" class="btn btn-danger waves-effect waves-light btn-sm" data-id="${e}" data-type="${t}" data-file="pdf"><i class="fe-download me-1"></i> Pdf</button>\n                        </div>`}var DataReport={init:function(){$("#search-station-table").keyup(function(){dataTableReport.search($(this).val()).draw()}),$("#length-station-table").change(function(){dataTableReport.page.len($(this).val()).draw()}),$("#type").selectize(),TYPE=$("#type").val(),(dataTableReport=$("#table-report").DataTable({processing:!0,serverSide:!0,paging:!1,dom:"rti",order:[[2,"asc"]],ajax:{url:"/DownloadData/GetDatatableStation?type="+TYPE,type:"POST",dataType:"JSON"},columns:[{data:null},{data:"name",name:"Name"},{data:"type",name:"Type",render:function(e,t,a){let n=posName[e];return console.log(n),posName[e]}},{render:function(e,t,a){return"AWLR"==a.type||"V-Notch"==a.type?generateDownloadButton(a.id,a.type,"btn-blue"):"AWLR_ARR"==a.type?generateDownloadButton(a.id,a.type,"btn-warning"):"ARR"==a.type?generateDownloadButton(a.id,a.type,"btn-success"):"AWS"==a.type?generateDownloadButton(a.id,a.type,"btn-danger"):"WQMS"==a.type?generateDownloadButton(a.id,a.type,"btn-primary"):`<button onclick="downloadData(this,event);" type="button" class="btn btn-xs btn-info me-1" data-id="${a.id}" data-type="${a.type}"><i class="fe-download me-1"></i> Download</button>`}}],columnDefs:[{targets:0,searchable:!1,orderable:!1,width:"9%",className:"text-center"},{targets:-1,searchable:!1,orderable:!1,width:"18%",className:"text-center"}],language:{paginate:{previous:"<i class='mdi mdi-chevron-left'>",next:"<i class='mdi mdi-chevron-right'>"}},drawCallback:function(){$(".dataTables_paginate > .pagination").addClass("pagination-rounded")}})).on("draw.dt",function(){var e=dataTableReport.page.info();dataTableReport.column(0,{search:"applied",order:"applied",page:"applied"}).nodes().each(function(t,a){t.innerHTML=a+1+e.start})})}};function monthYearToYM(e){const[t,a]=e.split(" "),n=new Date(Date.parse(t+" 1, "+a)).getMonth()+1;return a+"-"+(n<10?"0"+n:n)}function allMonthsToYM(e){const t=e.split(" ")[1];return["January","February","March","April","May","June","July","August","September","October","November","December"].map(e=>monthYearToYM(e+" "+t))}function downloadData(e,t){t.preventDefault(),periode=$("#get-periode").val();const a=$(e).data("id"),n=$(e).data("type"),o=$(e).data("file"),r=$("#selectTime").val();if("year"==r){const e=$("#periode").val();if(""==e||null==e)return void showMessage("error","Error","Periode Wajib Diisi");periode=e}if("ARR"==n||"AWLR"==n)if(["ARR","AWLR","AWS","AWLR_ARR","V-Notch"].includes(n)){const e=`/DownloadData/Download?stationid=${a}&type=${n}&periode=${periode="year"==r?$("#periode").val():monthYearToYM($("#periode").val())}&file_type=${o}`;window.open(e,"_blank")}else showMessage("info","Mohon Maaf","Fitur Sedang Dalam Pengembangan");else showMessage("info","Mohon Maaf","Fitur Sedang Dalam Pengembangan")}function searchData(e,t){t.preventDefault(),console.log($("#search-report-table").val()),dataTableReport.ajax.reload()}function generateDatePicker(e){$("#periode").datepicker("destroy"),"month"==e?$("#periode").datepicker({format:"MM yyyy",startView:"months",minViewMode:"months",beforeShowMonth:function(e){return e.valueOf()<=(new Date).valueOf()},autoclose:!0,altFormat:"yyyy-mm",altField:"#get-periode"}).on("changeDate",function(e){let t=convertTimestampToYearAndMonth(e.timeStamp);const a=t.month>9?t.month:`0${t.month}`;var n=`${t.year}-${a}`;$("#get-periode").val(n)}):$("#periode").datepicker({format:"yyyy",startView:"years",minViewMode:"years",autoclose:!0,endDate:new Date,beforeShowYear:function(e){return e.getFullYear()<=(new Date).getFullYear()},altField:"#get-periode",altFormat:"yyyy"}).on("changeDate",function(e){let t=convertTimestampToYearAndMonth(e.timeStamp);$("#get-periode").val(t.year)}),$("#periode").datepicker("setDate",new Date)}function convertTimestampToYearAndMonth(e){var t=new Date(e);return{year:t.getFullYear(),month:t.getMonth()+1}}jQuery(document).ready(function(){$("#periode").trigger("change"),$("#type").selectize(),$("#selectTime").selectize(),generateDatePicker($("#selectTime").val()),DataReport.init()}),$("#periode").on("change",function(){periode=monthYearToYM($(this).val())}),$("#selectTime").on("change",function(){const e=$(this).val();$("#type").val();generateDatePicker(e)}),$("#type").on("change",function(){dataTableReport.destroy(),TYPE=$(this).val();var e=$("#selectTime")[0].selectize;"ARR"!=TYPE&&"AWLR"!=TYPE?(e.setValue("month"),generateDatePicker($("#selectTime").val()),e.disable("month")):(e.enable(),generateDatePicker($("#selectTime").val())),DataReport.init(),dataTableReport.ajax.reload()});