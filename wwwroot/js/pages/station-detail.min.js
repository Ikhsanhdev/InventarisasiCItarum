"use strict";var dataTelemetriAwlr,dataTelemetriArr;const NOW_YEAR=(new Date).getFullYear(),STATION_ID=$("#station-id").val(),STATION_TYPE=$("#station-type").val(),FIRST_TAB=$(".tab-data")[0];let URL,WAKTU;var CHART,CHART_DEBIT;const element=document.getElementById("data-telemetry-desc");function fetchData(a){let e=generateUrl(a);"data-pos"==a&&GetDataPos(e,STATION_ID),"data-telemetri"==a&&loadPartialView(a),"data-grafik"==a&&loadPartialView(a)}function generateUrl(a){switch(a){case"data-pos":return`/StationDetail/GetDataPos?StationId=${STATION_ID}`;case"data-telemetri":return`/StationDetail/GetDataTelemetri?StationId=${STATION_ID}`;case"data-grafik":return`/StationDetail/GetDataGrafik?StationId=${STATION_ID}`}}function GetDataPos(a,e){getData(a,e).then(a=>{var e=a.data.result;$("#pos-name").text(e.name),"AWLR"==e.type?$("#pos-desc").text("Pos Duga Air"):"ARR"==e.type?$("#pos-desc").text("Pos Curah Hujan"):$("#pos-desc").text("-"),null==e.image?e.image="/images/default-image.png":e.image=`/uploads/images/stations/${e.image}`,$("#pos-image").attr("src",e.image),$("#detail_no_register").text(null==e.no_register?"-":e.no_register),$("#detail_elevation").text(null==e.elevation?"-":e.elevation),$("#detail_device_id").text(null==e.device_id?"-":e.device_id),$("#detail_device_merk").text(null==e.brand_name?"-":e.brand_name),$("#detail_wilayah_sungai").text(null==e.river_area_name?"-":e.river_area_name),$("#detail_das").text(null==e.watershedName?"-":e.watershedName),$("#detail_built_by").text(null==e.built_by?"-":e.built_by),$("#detail_built_year").text(null==e.built_year?"-":e.built_year),$("#detail_renov_by").text(null==e.renovation_by?"-":e.renovation_by),$("#detail_renov_year").text(null==e.renovation_by?"-":e.renovation_by),$("#detail_note").text(null==e.note?"-":e.note),$("#detail_coordinate").text(`${e.latitude} , ${e.longitude}`),$("#detail_province").text(null==e.province_name?"-":e.province_name),$("#detail_district").text(null==e.district_name?"-":e.district_name),$("#detail_village").text(null==e.village_name?"-":e.village_name),$("#detail_city").text(null==e.regency_name?"-":e.regency_name)})}function loadDataGrafik(a,e,t){$.ajax({url:`/StationDetail/GetDataGrafik?id=${STATION_ID}&waktu=${e}&periode=${t}`,type:"GET",dataType:"json",async:!0,success:function(e){if(0==e.dataGrafik.length){const a=document.getElementById("container");"undefined"!=typeof Highcharts&&a&&CHART&&(CHART.destroy(),CHART=null);const e='<div class="text-center"> \n                                    <h5 class="text-secondary" id="not-exist-1">Data Grafik Tidak Tersedia</h5>\n                                </div>';document.getElementById("not-exist-1")||$("#container").append(e),$("#label-grafik").hide()}else $("#label-grafik").show(),generateGrafik(a,t,e,e.isElevasiExist,e.defaultElevation)},error:function(a,e,t){console.error("Error: "+e+" - "+t)}})}function loadDataGrafikDebit(a,e,t){$.ajax({url:`/StationDetail/GetDataGrafik?id=${STATION_ID}&waktu=${e}&periode=${t}`,type:"GET",dataType:"json",async:!0,success:function(e){if("AWLR"===a)if(0==e.dataGrafikDebit.length){const a=document.getElementById("container");"undefined"!=typeof Highcharts&&a&&CHART_DEBIT&&(CHART_DEBIT.destroy(),CHART_DEBIT=null);const e='<div class="text-center">\n                                    <h5 class="text-secondary" id="not-exist">Data Grafik Tidak Tersedia</h5>\n                                </div>';document.getElementById("not-exist")||$("#container-debit").append(e)}else generateGrafikDebit(a,t,e,e.isElevasiExist,e.defaultElevation)},error:function(a,e,t){console.error("Error: "+e+" - "+t)}})}function generateGrafik(a,e,t,i,n){let r=generateData(t.dataGrafik,i),l=null==t.dataTma?null:t.dataSiaga.siaga1>t.dataTma.tmaMax?t.dataSiaga.siaga1:t.dataTma.tmaMax;l=0==l?.5:l+1,console.log(t);let o="";if(2==e.split("-").length){o=moment(e,"YYYY-MM").locale("id").format("MMMM YYYY")}else{o=moment(e,"YYYY-MM-DD").locale("id").format("DD MMMM YYYY")}"AWLR"==a.toUpperCase()&&(CHART=Highcharts.stockChart("container",{navigation:{buttonOptions:{enabled:!1}},rangeSelector:{enabled:!1},title:{text:"Grafik Tinggi Muka Air"},subtitle:{text:`Per ${o}`},yAxis:i?[{title:{text:"Tinggi Muka Air (m)"},max:l,min:0,opposite:!1,plotLines:[{value:t.dataSiaga.siaga3,color:"yellow",dashStyle:"shortdash",width:2,label:{text:"Siaga 3"}},{value:t.dataSiaga.siaga2,color:"orange",dashStyle:"shortdash",width:2,label:{text:"Siaga 2"}},{value:t.dataSiaga.siaga1,color:"red",dashStyle:"shortdash",width:2,label:{text:"Siaga 1"}}]},{title:{text:"Elevasi (Mdpl)"},max:n+t.dataTma.tmaMax,min:n+t.dataTma.tmaMin,opposite:!0,showLastLabel:!0,plotLines:[]}]:{title:{text:"Tinggi Muka Air (m)"},max:l,min:t.dataTma.tmaMin,opposite:!1,plotLines:[{value:t.dataSiaga.siaga3,color:"yellow",dashStyle:"shortdash",width:2,label:{text:"Siaga 3"}},{value:t.dataSiaga.siaga2,color:"orange",dashStyle:"shortdash",width:2,label:{text:"Siaga 2"}},{value:t.dataSiaga.siaga1,color:"red",dashStyle:"shortdash",width:2,label:{text:"Siaga 1"}}]},xAxis:{type:"datetime",labels:{format:"{value:%H:%M}",dateTimeLabelFormats:{hour:"%H:%M"}}},plotOptions:{series:{marker:{enabled:!0,radius:2,symbol:"circle"},lineWidth:1,animation:!0}},tooltip:{formatter(){let a="<b>"+Highcharts.dateFormat(" %e %B  %Y %H:%M",this.x)+"</b>";return this.points.forEach(e=>{const t=e.y;e.point.y2;i?(a+="<br/>TMA         = "+t+" m",a+=null==n?"<br/>Elevasi = -":"<br/>Elevasi = "+(t+n)+" Mdpl"):a+="<br/>TMA = "+e.y+" m"}),a}},series:[{name:"TMA",type:"line",data:r,lineColor:Highcharts.getOptions().colors[0]}]})),"ARR"==a.toUpperCase()&&(console.log(r),Highcharts.stockChart("container",{chart:{alignTicks:!1},rangeSelector:{selected:1},navigator:{enabled:!1},title:{text:"Grafik Curah Hujan"},subtitle:{text:`Per ${o}`},xAxis:{type:"datetime",ccrosshair:!0,title:{text:"Jam"},labels:{format:"{value:%H}"},dateTimeLabelFormats:{hour:"%H"},tickInterval:36e5},yAxis:{title:{text:"Curah Hujan (mm)"},stackLabels:{style:{color:"#000000",fontWeight:"bold"},enabled:!0,verticalAlign:"top"},opposite:!1},plotOptions:{column:{stacking:"normal",pointPadding:0,groupPadding:0,dataLabels:{enabled:!1},zones:[{value:0,color:"#6C757D"},{value:5,color:"#1ABC9C"},{value:10,color:"#FFC008"},{value:20,color:"#FF7820"},{color:"#F1556C"}]}},tooltip:{formatter(){let a="<b>"+Highcharts.dateFormat(" %e %B  %Y %H:%M",this.x)+"</b>";return this.points.forEach(e=>{e.y;a+="<br/>CH = "+e.y+" mm"}),a}},series:[{type:"column",name:"CH",data:r.map(a=>({x:a[0],y:a[1]}))}]}))}function generateGrafikDebit(a,e,t,i,n){let r=generateDataDebit(t.dataGrafikDebit,!1),l="";if(2==e.split("-").length){l=moment(e,"YYYY-MM").locale("id").format("MMMM YYYY")}else{l=moment(e,"YYYY-MM-DD").locale("id").format("DD MMMM YYYY")}"AWLR"==a.toUpperCase()&&(CHART_DEBIT=Highcharts.stockChart("container-debit",{navigation:{buttonOptions:{enabled:!1}},rangeSelector:{enabled:!1},title:{text:"Grafik Debit"},subtitle:{text:`Per ${l}`},yAxis:{title:{text:"Debit (m3/s)"},max:maxSiaga,min:0,opposite:!1},xAxis:{gapGridLineWidth:0},plotOptions:{series:{marker:{enabled:!0,radius:4,symbol:"circle"},lineWidth:2,animation:!0}},tooltip:{formatter(){let a="<b>"+Highcharts.dateFormat(" %e %b , %Y",this.x)+"</b>";return this.points.forEach(e=>{const t=e.y;e.point.y2;i?(console.log(e),a+="<br/>TMA         = "+t+" m",a+=null==n?"<br/>Elevasi = -":"<br/>Elevasi = "+(t+n)+" Mdpl"):a+="<br/>TMA = "+e.y+" m"}),a}},series:[{name:"Debit",type:"line",data:r,lineColor:Highcharts.getOptions().colors[0]}]}))}function loadPartialView(a){$(".loading-spinner").css("display","block");let e="",t="";switch(a){case"data-pos":e=`/StationDetail/LoadPartialView?ToData=${a}&Type=${STATION_TYPE}`;break;case"data-telemetri":t="tab-data-telemetri",e=`/StationDetail/LoadPartialView?ToData=${a}&Type=${STATION_TYPE}`;break;case"data-grafik":t="tab-data-grafik",e=`/StationDetail/LoadPartialView?ToData=${a}&Type=${STATION_TYPE}`}$.ajax({url:e,type:"GET",dataType:"html",success:function(a){$(".loading-spinner").css("display","none"),$(`#${t}`).html(a)},error:function(){alert("An error occurred while loading the partial view.")}})}function loadDatePicker(a,e){if("data-grafik"==a)switch($("#periode-grafik").datepicker("destroy"),$("#periode-akhir").datepicker("destroy"),e){case"menit":case"jam":$("#periode-grafik").datepicker({format:"yyyy-mm-dd",autoclose:!0,todayHighlight:!0,endDate:"{{ date('Y-m-d') }}",orientation:"bottom"}).on("changeDate",function(a){var e=new Date(a.date.valueOf());console.log(e),$("#periode-akhir").datepicker("setStartDate",e)}),$("#periode-akhir").datepicker({format:"yyyy-mm-dd",autoclose:!0,todayHighlight:!0,endDate:"{{ date('Y-m-d') }}",orientation:"bottom",onSelect:function(a){$("#periode-grafik").datepicker("option","maxDate",a)}}).on("changeDate",function(a){var e=new Date(a.date.valueOf());$("#periode-grafik").datepicker("setEndDate",e)}),$("#periode-grafik").datepicker("update","{{ date('Y-m-d') }}"),$("#periode-akhir").datepicker("update","{{ date('Y-m-d') }}");break;case"hari":$("#periode-grafik").datepicker({format:"yyyy-mm",viewMode:"months",minViewMode:"months",endDate:"{{ date('Y-m') }}",autoclose:!0,todayHighlight:!0,orientation:"bottom"}),$("#periode-grafik").datepicker("update","{{ date('Y-m') }}")}if("data-telemetri"==a)switch($("#periode").datepicker("destroy"),e){case"menit":case"jam":$("#periode").datepicker({format:"yyyy-mm-dd",autoclose:!0,todayHighlight:!0,endDate:"{{ date('Y-m-d') }}",orientation:"bottom"}),$("#periode").datepicker("update","{{ date('Y-m-d') }}");break;case"hari":$("#periode").datepicker({format:"yyyy-mm",viewMode:"months",minViewMode:"months",endDate:"{{ date('Y-m') }}",autoclose:!0,todayHighlight:!0,orientation:"bottom"}),$("#periode").datepicker("update","{{ date('Y-m') }}")}}function loadDataTelemetriAwlr(a){$("#table-telemetri").DataTable().destroy(),dataTelemetriAwlr=$("#table-telemetri").DataTable({dom:"rti",paging:!1,order:[[0,"desc"]],ajax:{url:a,type:"POST",contentType:"application/json",dataType:"JSON",data:function(a){return JSON.stringify(a)}},columns:[{data:"tanggal",name:"tanggal",render:function(a,e,t){return console.log(a),moment(a).locale("id").format("D MMMM YYYY")}},{data:"jam",render:function(a,e,t){return""==a||null==a||null==a?"":(console.log(a),moment(a).locale("id").format("HH:mm"))}},{data:"tma"},{data:"perubahanStatus",render:function(a,e,t){return null==a||""==a||"constant"==a?"":"decrease"==a?`<span><i class="mdi mdi-arrow-down-circle text-success font-weight-bold"\n                                style="font-size: 15px;"></i> ${t.perubahanValue} ${t.satuanPerubahan}</span>`:"increase"==a?`<span><i class="mdi mdi-arrow-up-circle text-danger font-weight-bold"\n                                style="font-size: 15px;"></i> ${t.perubahanValue} ${t.satuanPerubahan}</span>`:void 0}},{data:"debit"},{data:"status",render:function(a,e,t){if(""==a||null==a||null==a)return"";switch(a){case"Normal":return`<span class="badge bg-soft-success text-success">${a}</span>`;case"Siaga 1":return`<span class="badge bg-soft-danger text-danger">${a}</span>`;case"Siaga 2":return`<span class="badge bg-soft-success text-success">${a}</span>`;case"Siaga 3":return`<span class="badge bg-soft-warning text-warning">${a}</span>`}}}]})}function loadDataTelemetriArr(a,e){$("#table-telemetri").DataTable().destroy(),"MENIT"==e.toUpperCase()&&(dataTelemetriArr=$("#table-telemetri").DataTable({dom:"rti",paging:!1,order:[[1,"desc"]],ajax:{url:a,type:"POST",contentType:"application/json",dataType:"JSON",data:function(a){return JSON.stringify(a)}},columns:[{data:null},{data:"tanggal",render:function(a,e,t){return console.log(a),moment(a).locale("id").format("D MMMM YYYY")}},{data:"jam",render:function(a,e,t){return""==a||null==a||null==a?"":moment(a).locale("id").format("HH:mm")}},{data:"ch"}]})),"JAM"==e.toUpperCase()&&(dataTelemetriArr=$("#table-telemetri").DataTable({dom:"rti",paging:!1,order:[[1,"desc"]],ajax:{url:a,type:"POST",contentType:"application/json",dataType:"JSON",data:function(a){return JSON.stringify(a)}},columns:[{data:null},{data:"tanggal",render:function(a,e,t){return moment(a).locale("id").format("D MMMM YYYY")}},{data:"jam",render:function(a,e,t){return""==a||null==a||null==a?"":moment(a).locale("id").format("HH:mm")}},{data:"ch",name:"ch"},{data:"intensitas",name:"intensitas"}]})),"HARI"==e.toUpperCase()&&(dataTelemetriArr=$("#table-telemetri").DataTable({dom:"rti",paging:!1,order:[[1,"desc"]],ajax:{url:a,type:"POST",contentType:"application/json",dataType:"JSON",data:function(a){return JSON.stringify(a)}},columns:[{data:null},{data:"datetimeOnly",render:function(a,e,t){return console.log(a),moment(a).locale("id").format("D MMMM YYYY")}},{data:"ch",name:"ch"},{data:"intensitas",name:"intensitas"}]})),dataTelemetriArr.on("draw.dt",function(){var a=dataTelemetriArr.page.info();dataTelemetriArr.column(0,{search:"applied",order:"applied",page:"applied"}).nodes().each(function(e,t){e.innerHTML=t+1+a.start})})}function generateData(a,e){if(null==a||null==a||0==a.length)return[];let t=[];return t=e?a.map(a=>[a.millis,a.value,a.elevasi]):a.map(a=>[a.millis,a.value])}function generateDataGrafik(a,e){if(null==a||null==a||0==a.length)return[];let t=[];return t=a.map(a=>[a.millis,a.debit])}function loadPartialTableArr(a){$.ajax({url:"/StationDetail/LoadPartialTableArr",type:"GET",dataType:"html",data:{waktu:a},success:function(a){$("#parent-table").html(a)},error:function(){alert("An error occurred while loading the partial view.")}})}function loadPartialTableAwlr(a){$.ajax({url:"/StationDetail/LoadPartialTableAwlr",type:"GET",dataType:"html",data:{waktu:a},success:function(a){$("#parent-table").html(a)},error:function(){alert("An error occurred while loading the partial view.")}})}function loadDataTelemetriAwlr(a,e){$("#table-telemetri").DataTable().destroy(),"MENIT"!=e.toUpperCase()&&"JAM"!=e.toUpperCase()||(dataTelemetriAwlr=$("#table-telemetri").DataTable({dom:"rti",paging:!1,order:[[0,"desc"]],ajax:{url:a,type:"POST",contentType:"application/json",dataType:"JSON",data:function(a){return JSON.stringify(a)}},columns:[{data:"tanggal",name:"tanggal",className:"text-center",render:function(a,e,t){return console.log(a),moment(a).locale("id").format("D MMMM YYYY")}},{data:"jam",name:"jam",className:"text-center",render:function(a,e,t){return""==a||null==a||null==a?"":(console.log(a),moment(a).locale("id").format("HH:mm"))}},{data:"tma",className:"text-center"},{data:"elevasi",className:"text-center",render:function(a,e,t){return""==a||null==a||null==a?"":a<=0?a:`+${a}`}},{data:"perubahanStatus",className:"text-center",render:function(a,e,t){return null==a||""==a||"constant"==a?"":"decrease"==a?`<span><i class="mdi mdi-arrow-down-circle text-success font-weight-bold"\n                                style="font-size: 15px;"></i> ${t.perubahanValue} ${t.satuanPerubahan}</span>`:"increase"==a?`<span><i class="mdi mdi-arrow-up-circle text-danger font-weight-bold"\n                                style="font-size: 15px;"></i> ${t.perubahanValue} ${t.satuanPerubahan}</span>`:void 0}},{data:"debit",className:"text-center"},{data:"status",className:"text-center",render:function(a,e,t){if(""==a||null==a||null==a)return"";switch(a){case"Normal":return`<span class="badge bg-soft-success text-success">${a}</span>`;case"Siaga 1":return`<span class="badge bg-soft-danger text-danger">${a}</span>`;case"Siaga 2":return`<span class="badge bg-soft-success text-success">${a}</span>`;case"Siaga 3":return`<span class="badge bg-soft-warning text-warning">${a}</span>`}}}]})),"HARI"==e.toUpperCase()&&(dataTelemetriAwlr=$("#table-telemetri").DataTable({dom:"rti",paging:!1,order:[[0,"desc"]],ajax:{url:a,type:"POST",contentType:"application/json",dataType:"JSON",data:function(a){return JSON.stringify(a)}},columns:[{data:"tanggal"},{data:"average",name:"average",className:"text-center"},{data:"tmaMin",name:"tmaMin",className:"text-center"},{data:"tmaMax",name:"tmaMax",className:"text-center"}]}))}$(document).ready(function(){FIRST_TAB.click()}),$(".tab-data").on("click",function(){fetchData($(this).data("id"))});