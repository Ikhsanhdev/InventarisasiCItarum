"use strict";var dataTablePetak,dataTableSmopi,dataTableKebutuhan,dataPetak={init:function(){!function(){$(".parsley-validation").parsley(),$("#search-petak-table").keyup(function(){dataTablePetak.search($(this).val()).draw()}),$("#length-petak-table").change(function(){dataTablePetak.page.len($(this).val()).draw()}),$("#length-kebutuhan-table").change(function(){dataTableKebutuhan.page.len($(this).val()).draw()}),$("#periode").on("change",function(){dataTableKebutuhan.ajax.reload()}),$("#btn-sync-smopi").on("click",function(){var a=$(this);$.ajax({url:"/Master/SyncronDataSmopi",type:"POST",beforeSend:function(){a.addClass("disabled"),a.html('<span class="spinner-border spinner-border-sm me-1" role="status" aria-hidden="true"></span> Loading...')},success:function(e){a.removeClass("disabled"),a.html("Sinkronsisasi Data SMOPI"),console.log(e.message),e.isSuccess?showMessage("success","Sukses!",e.message):showMessage("error","Terjadi Kesalahan!",e.message),dataTableKebutuhan.ajax.reload()},error:function(){a.removeClass("disabled"),a.html("Sinkronsisasi Data SMOPI"),showMessage("error","Terjadi Kesalahan!","Ajax Error")}})});var a=new Date;let e=a.getFullYear(),t=a.getMonth();a.getDate()<16?$("#periode").val("1"):$("#periode").val("2"),$("#month-year").datepicker({format:"MM yyyy",viewMode:"months",minViewMode:"months",autoclose:!0,todayHighlight:!0,orientation:"bottom",language:"id"}).datepicker("setDate",new Date(e,t,1)).on("changeDate",function(a){var e=a.date,t=e.getFullYear(),n=e.getMonth()+1,s=t+"-"+n;$("#year").val(t),$("#month").val(n),$(this).val(s),dataTableKebutuhan.ajax.reload()})}(),(dataTablePetak=$("#table-petak").DataTable({processing:!0,serverSide:!0,dom:"tipr",order:[[2,"asc"]],ajax:{url:"/Master/GetDataPetak",type:"POST",dataType:"JSON"},columns:[{data:null},{data:"namaPetak",name:"NamaPetak"},{data:"jenisBangunan",name:"JenisBangunan"},{data:"namaBangunan",name:"NamaBangunan"},{data:"luas",name:"Luas"},{data:"debitKebutuhan",name:"DebitKebutuhan"},{data:"location",name:"Location"},{className:"text-nowrap",render:function(a,e,t){return`<button type="button" class="btn btn-xs btn-success me-1 rounded-2" data-id="${t.id}" onclick="createEditPetak(this, event)"><i class="mdi mdi-square-edit-outline me-1"></i>Edit</button>\n                                    <button type="button" class="btn btn-xs btn-danger rounded-2" data-id="${t.id}" onclick="deletePetak(this, event)"><i class="mdi mdi-delete me-1"></i>Delete</button>`}}],columnDefs:[{targets:0,searchable:!1,orderable:!1,width:"9%",className:"text-center"},{targets:-1,searchable:!1,orderable:!1,width:"18%",className:"text-center"}],language:{paginate:{previous:"<i class='mdi mdi-chevron-left'>",next:"<i class='mdi mdi-chevron-right'>"}},drawCallback:function(){$(".dataTables_paginate > .pagination").addClass("pagination-rounded")}})).on("draw.dt",function(){var a=dataTablePetak.page.info();dataTablePetak.column(0,{search:"applied",order:"applied",page:"applied"}).nodes().each(function(e,t){e.innerHTML=t+1+a.start})}),$.ajax({url:"/Master/GetDataSmopi",method:"GET",success:function(a){dataTableSmopi=$("#table-smopi").DataTable({data:a,columns:[{data:"nama_rentang"},{data:"tahun",className:"text-center"},{data:"bulan",className:"text-center"},{data:"periode",className:"text-center"},{data:"kebair",className:"text-start",render:function(a){return null==a?"":""==a?"":parseFloat(a).toFixed(1)}}],paging:!1,searching:!0,ordering:!0})},error:function(a){console.error("Error fetching data",a)}}),dataTableKebutuhan=$("#table-kebutuhan-db").DataTable({processing:!0,serverSide:!0,dom:"tipr",order:[[2,"asc"]],pageLength:20,ajax:{url:"/Master/GetDataKetersediaan",type:"POST",dataType:"JSON",data:function(a){a.year=$("#year").val(),a.month=$("#month").val(),a.periode=$("#periode").val()}},columns:[{data:"tanggal",name:"tanggal",render:function(a){return moment(a).locale("id").format("DD MMMM YYYY")}},{data:"periode",name:"periode"},{data:"ketersediaan_min",name:"ketersediaan_min"},{data:"ketersediaan_max",name:"ketersediaan_max"},{data:"ketersediaan_avg",name:"ketersediaan_avg"},{data:"kebutuhan",name:"kebutuhan"},{data:"updated_at",name:"updated_at",render:function(a){return moment(a).locale("id").format("DD MMMM YYYY")+' <small class="text-muted">'+moment(a).locale("id").format("HH:mm:ss")+"</small>"}}],columnDefs:[{targets:0,searchable:!1,orderable:!1,width:"13%",className:"text-center"},{targets:[2,3,4,5],render:function(a){return null==a?"":""==a?"":parseFloat(a.toFixed(1))}},{targets:-1,searchable:!1,orderable:!1,width:"18%",className:"text-center"}],language:{paginate:{previous:"<i class='mdi mdi-chevron-left'>",next:"<i class='mdi mdi-chevron-right'>"}},drawCallback:function(){$(".dataTables_paginate > .pagination").addClass("pagination-rounded")}})}};jQuery(document).ready(function(){dataPetak.init()}),window.createEditPetak=((a,e)=>{e.preventDefault();var t=$(a).html();beforeLoadingButton($(a));var n=$(a).data("id"),s=new FormData;s.append("Id",n),postData("/Master/CreateEditPetak",s).then(e=>{let n=e.data;$("#modalCreateEditPetak .modal-content").html(n),$("#modalCreateEditPetak").modal("show"),afterLoadingButton($(a),t)})}),window.savePetak=((a,e)=>{e.preventDefault();var t=$(a).find("button[type=submit]");if($(a).parsley().validate(),$(a).parsley().isValid()){beforeLoadingButton(t);var n=new FormData;n.append("Id",getValueById("Id")),n.append("NamaPetak",getValueById("NamaPetak")),n.append("JenisBangunan",getValueById("JenisBangunan")),n.append("Luas",getValueById("Luas")),n.append("DebitKebutuhan",getValueById("DebitKebutuhan")),n.append("Location",getValueById("Location")),postData("/Master/SavePetak",n).then(a=>{let e=a.data;200==e.code?($("#modalCreateEditPetak").modal("hide"),showMessage("success","Sukses!",e.message),dataTablePetak.ajax.reload()):showMessage("error","Gagal!",e.message),afterLoadingButton(t)}).catch(a=>{console.log(a),afterLoadingButton(t)})}}),window.deletePetak=((a,e)=>{e.preventDefault();var t=$(a).data("id");Swal.fire({title:"Hapus Petak",text:"Anda yakin untuk menghapus Petak tersebut ?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal",showLoaderOnConfirm:!0,preConfirm:()=>deleteData("/Master/DeletePetak/"+t).then(a=>{if(200!==a.status)throw new Error(a.statusText);return a}).catch(a=>{Swal.showValidationMessage(`Request failed: ${a}`)}),allowOutsideClick:()=>!Swal.isLoading()}).then(a=>{console.log(a),a.isConfirmed&&(200==a.value.data.code?(showMessage("success","Sukses!",a.value.data.message),dataTablePetak.ajax.reload()):showMessage("error","Failed",a.value.data.message))})});