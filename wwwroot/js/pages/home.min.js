"use strict";let markers;var load_markers=[];let contentPopup,markerIcon,popup;var mapElement=$(document.getElementById("ts-map-hero")),mapDefaultZoom=parseInt(mapElement.attr("data-map-zoom"),10),mapCenterLatitude=mapElement.attr("data-map-center-latitude"),mapCenterLongitude=mapElement.attr("data-map-center-longitude"),map=L.map("ts-map-hero",{maxZoom:17}).setView([mapCenterLatitude,mapCenterLongitude],mapDefaultZoom),RealtimeMonitoringSystem=function(){var a=function(){$.ajax({url:"Reading/GetLastReading",type:"GET",dataType:"JSON",beforeSend:function(){$("#group-awlr, #group-arr").fadeOut(300),$("#group-awlr-shimmer, #group-arr-shimmer").fadeIn(300)},success:function(a){if($("#group-awlr-shimmer, #group-arr-shimmer").fadeOut(300),$("#group-awlr, #group-arr").fadeIn(300),a.length>0){$.each(a,function(a,e){let n="",t="",s="",i="",r="bg-awlr-normal",l="",d="",c="",o="",m="",p="",g="",v=" <p>-</p>",u="";if(e.devices.length>0){switch(contentPopup="",e.type){case"AWLR":if(null!=e.devices[0].awlrLastReading){switch(null!=e.devices[0].awlrLastReading.waterLevel&&(l=e.devices[0].awlrLastReading.waterLevel),null!=e.devices[0].awlrLastReading.waterLevelMin&&(c=e.devices[0].awlrLastReading.waterLevelMin),null!=e.devices[0].awlrLastReading.waterLevelMax&&(o=e.devices[0].awlrLastReading.waterLevelMax),n=null==e.devices[0].awlrLastReading.readingAt?"Data tidak tersedia":`${t=moment(e.devices[0].awlrLastReading.readingAt).locale("id").format("dddd, D MMMM YYYY")} <span class="text-muted">${s=moment(e.devices[0].awlrLastReading.readingAt).locale("id").format("HH:mm")} WIB</span>`,null!=e.devices[0].awlrSetting&&(null!=e.devices[0].awlrSetting.siaga1&&null!=e.devices[0].awlrSetting.siaga2&&null!=e.devices[0].awlrSetting.siaga3&&(i=`<div class="progress-meter mb-2">\n                                                    <div class="meter meter-normal meter-left" style="width: 25%;" title="Normal <br> < ${e.devices[0].awlrSetting.siaga3} m" tabindex="0" data-plugin="tippy" data-tippy-followCursor="true" data-tippy-arrow="true" data-tippy-animation="fade"><span class="meter-text">0</span></div>\n                                                    <div class="meter meter-waspada meter-left" style="width: 25%;" title="Siaga 3 <br> ${e.devices[0].awlrSetting.siaga3} m - ${e.devices[0].awlrSetting.siaga2} m" tabindex="0" data-plugin="tippy" data-tippy-followCursor="true" data-tippy-arrow="true" data-tippy-animation="fade"><span class="meter-text">${e.devices[0].awlrSetting.siaga3} m</span></div>\n                                                    <div class="meter meter-siaga meter-left" style="width: 25%;" title="Siaga 2 <br> ${e.devices[0].awlrSetting.siaga2} m - ${e.devices[0].awlrSetting.siaga1} m" tabindex="0" data-plugin="tippy" data-tippy-followCursor="true" data-tippy-arrow="true" data-tippy-animation="fade"><span class="meter-text">${e.devices[0].awlrSetting.siaga2} m</span></div>\n                                                    <div class="meter meter-awas meter-left" style="width: 25%;" title="Siaga 1 <br> > ${e.devices[0].awlrSetting.siaga1} m" tabindex="0" data-plugin="tippy" data-tippy-followCursor="true" data-tippy-arrow="true" data-tippy-animation="fade"><span class="meter-text">${e.devices[0].awlrSetting.siaga1} m</span></div>\n                                                </div>`),d="mdpl"==e.devices[0].awlrSetting.unit?"Mdpl":e.devices[0].awlrSetting.unit),e.devices[0].awlrLastReading.wlStatus){case"Normal":r="bg-awlr-normal",u="";break;case"Siaga 3":r="bg-awlr-siaga3",u="alert-siaga3";break;case"Siaga 2":r="bg-awlr-siaga2",u="alert-siaga2";break;case"Siaga 1":r="bg-awlr-siaga1",u="alert-siaga1";break;default:r="bg-awlr-normal",u=""}switch(e.devices[0].awlrLastReading.changeStatus){case"increase":m=`<p class="text-change-status">\n                                                    <span class="font-10" style="margin-right: 1px;color: #ed413e;">▲</span>\n                                                    <span class="fst-italic fw-bold font-12" style="color: #ed413e;"> +${e.devices[0].awlrLastReading.changeValue} ${d}</span>\n                                                </p>`;break;case"decrease":m=`<p class="text-change-status">\n                                                    <span class="font-10" style="color: #3B883E;margin-right: 1px;-webkit-transform: rotate(180deg);transform: rotate(180deg);display: inline-block;">▲</span>\n                                                    <span class="fst-italic fw-bold font-12" style="color: #3B883E;">${e.devices[0].awlrLastReading.changeValue} ${d}</span>\n                                                </p>`}var w="-";null!=e.devices[0].awlrLastReading.debit&&(w=e.devices[0].awlrLastReading.debit);var f=`<div class="card content-logger mb-1">\n                                            <div class="row no-gutters">\n                                                <div class="col-sm-3 content-sensor ${r} d-flex text-center">\n                                                    <div class="justify-content-center align-self-center w-100">\n                                                        <h4 class="font-16">${""==l?"-":l+" "+d}</h4>\n                                                        ${m}\n                                                    </div>\n                                                </div>\n                                                <div class="col-sm-9">\n                                                    <div class="card-body content-station pt-2">\n                                                        <div class="row">\n                                                            <div class="col-9">\n                                                                <h5 class="mb-1 mt-0 me-1">${e.name}</h5>\n                                                                <span class="badge badge-outline-secondary mb-1" style="align-self: flex-start;">${e.devices[0].brand.name} - ${e.devices[0].deviceId}</span>\n                                                                <p class="card-text">${n}</p>\n                                                                ${i}\n                                                            </div>\n                                                            <div class="col-3 text-center">\n                                                                <div class="${getLevelStatusCircle(e.devices[0].awlrLastReading.wlStatus)}">\n                                                                    <span style="display: block; font-size: 0.8rem; font-weight: 700;margin-bottom: 5px;"> ${w}</span>\n                                                                    <span style="display: block; font-size: 0.7rem; font-weight: 500;"> m<sup>3</sup>/s</span>\n                                                                </div>\n                                                                <span class="text-muted mt-1" style="display: block; font-size: 0.7rem; font-weight: 400;">Debit Air</span>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>`;document.getElementById("awlr-"+e.id)?$("#awlr-"+e.id).html(f):$("#group-awlr").append(`<div class="card-station" onclick="loadStationDetailCard(this, event)" id="awlr-${e.id}">\n                                                    ${f}\n                                                </div>`),markerIcon=L.icon({iconUrl:"/assets/images/marker-awlr-icon.png",iconSize:[32,43],popupAnchor:[0,-15]}),contentPopup=`<div class="table-responsive mb-2">\n                                            <table class="table table-sm mb-0">\n                                                <thead class="table-light">\n                                                    <tr>\n                                                        <th>Sensor</th>\n                                                        <th>Nilai</th>\n                                                        <th>Min</th>\n                                                        <th>Max</th>\n                                                    </tr>\n                                                </thead>\n                                                <tbody>\n                                                    <tr>\n                                                        <td><strong>Tinggi Muka Air</strong> (m)</td>\n                                                        <td class="text-center fw-bold">${l}</td>\n                                                        <td class="text-center fw-bold">${c}</td>\n                                                        <td class="text-center fw-bold">${o}</td>\n                                                    </tr>\n                                                </tbody>\n                                            </table>\n                                        </div>`,0}markerIcon=L.divIcon({iconSize:new L.Point(40,20),iconAnchor:new L.Point(20,20),html:`<div class="ts-marker-wrapper"><a href="javascript:void(0)" class="ts-marker ts-awlr" data-ts-id="64" data-ts-ln="60" style="outline: none;"><div class="ts-marker__title">${e.name}</div><div class="ts-marker__feature ts-marker__feature__blue ${u}"><i class="fas fa-water"></i></div></a></div>`});break;case"ARR":if(null!=e.devices[0].arrLastReading){var b='<div class="col-sm-3 content-sensor bg-no-data d-flex text-center">\n                                            <div class="justify-content-center align-self-center w-100">\n                                                <h4>-</h4>\n                                            </div>\n                                        </div>';null!=e.devices[0].arrLastReading.rainfallHour&&(g=e.devices[0].arrLastReading.rainfallHour),n=null==e.devices[0].arrLastReading.readingAt?"Data tidak tersedia":`${t=moment(e.devices[0].arrLastReading.readingAt).locale("id").format("dddd, D MMMM YYYY")} <span class="text-muted">${s=moment(e.devices[0].arrLastReading.readingAt).locale("id").format("HH:00")} WIB</span>`,null!=e.devices[0].arrLastReading.intensityHour&&(b=`<div class="col-sm-3 content-sensor bg-arr">\n                                                <div class="d-flex flex-column justify-content-center align-items-center bg-arr-am">\n                                                    ${v=`<img src="/images/intensity/${getIntensityIcon(p=e.devices[0].arrLastReading.intensityHour)}" alt="${p}">\n                                                <p class="text-intensity mb-0">${p}</p>`}\n                                                </div>\n                                            </div>`);var h=`<div class="card content-logger mb-1">\n                                            <div class="card-body p-0">\n                                                <div class="row no-gutters">\n                                                    ${b}\n                                                    <div class="col-sm-9">\n                                                        <div class="content-station">\n                                                            <div class="row">\n                                                                <div class="col-9">\n                                                                    <h5 class="mb-1 mt-0 me-1">${e.name}</h5>\n                                                                    <span class="badge badge-outline-secondary mb-1" style="align-self: flex-start;">${e.devices[0].brand.name} - ${e.devices[0].deviceId}</span>\n                                                                    <p class="card-text">${n}</p>\n                                                                </div>\n                                                                <div class="col-3">\n                                                                    <div class="${getIntensityCircle(p)}">\n                                                                        <span style="display: block; font-size: 1rem; font-weight: 700;"> ${g}</span>\n                                                                        <span style="display: block; font-size: 0.8rem; font-weight: 500;"> mm</span>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>`;document.getElementById("arr-"+e.id)?$("#arr"+e.id).html(h):$("#group-arr").append(`<div class="card-station" onclick="loadStationDetailCard(this, event)" id="arr-${e.id}">\n                                                    ${h}\n                                                </div>`),markerIcon=L.icon({iconUrl:"/assets/images/marker-arr-icon.png",iconSize:[32,43],popupAnchor:[0,-15]}),contentPopup=`<div class="table-responsive mb-2">\n                                            <table class="table table-sm mb-0">\n                                                <thead class="table-light">\n                                                    <tr>\n                                                        <th>Sensor</th>\n                                                        <th>Nilai</th>\n                                                        <th>Intensitas</th>\n                                                    </tr>\n                                                </thead>\n                                                <tbody>\n                                                    <tr>\n                                                        <td><strong>Curah Hujan</strong> (mm)</td>\n                                                        <td class="text-center fw-bold">${g}</td>\n                                                        <td class="text-center fw-bold">${p}</td>\n                                                    </tr>\n                                                </tbody>\n                                            </table>\n                                        </div>`,0}markerIcon=L.divIcon({iconSize:new L.Point(40,20),iconAnchor:new L.Point(20,20),html:`<div class="ts-marker-wrapper"><a href="javascript:void(0)" class="ts-marker ts-arr" data-ts-id="64" data-ts-ln="60" style="outline: none;"><div class="ts-marker__title">${e.name}</div><div class="ts-marker__feature ts-marker__feature__green"><i class="wi wi-sleet"></i></div></a></div>`});break;case"AWS":if(null!=e.devices[0].awsLastReading){null!=e.devices[0].awsLastReading.rainfallHour&&(g=e.devices[0].awsLastReading.rainfallHour),n=null==e.devices[0].awsLastReading.readingAt?"Data tidak tersedia":`${t=moment(e.devices[0].awsLastReading.readingAt).locale("id").format("dddd, D MMMM YYYY")} ${s=moment(e.devices[0].awsLastReading.readingAt).locale("id").format("HH:mm")} ${timezone_id}`,null!=e.devices[0].awsLastReading.intensityHour&&(p=e.devices[0].awsLastReading.intensityHour);var y=`<div class="card content-logger mb-1">\n                                            <div class="card-header bg-danger">\n                                                <h5 class="text-white my-0">${e.name} <span class="fw-normal float-end font-14">${n}</span></h5>\n                                            </div>\n                                            <div class="card-body px-2 py-0">\n                                                <ul class="list-group list-group-flush list-aws-sensor">\n                                                    <li class="list-group-item">\n                                                        <div class="row">\n                                                            <div class="col-md-6">\n                                                                <div class="d-flex align-items-center p-2">\n                                                                    <img src="/images/icons/icon-rainfall.png" class="me-2" height="35" alt="Rainfall Icon">\n                                                                    <div class="w-100">\n                                                                        <div class="row-sensor d-flex justify-content-between align-items-start fw-light">\n                                                                            <span>Curah Hujan :</span>\n                                                                            <span>${g} mm</span>\n                                                                        </div>  \n                                                                        <div class="row-sensor d-flex justify-content-between align-items-start fw-light">\n                                                                            <span>Intensitas :</span>\n                                                                            <span>${p}</span>\n                                                                        </div>  \n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                            <div class="col-md-6">\n                                                                <div class="d-flex align-items-center p-2">\n                                                                    <img src="/images/icons/icon-humidity.png" class="me-2" height="35" alt="Humidity Icon">\n                                                                    <div class="w-100">\n                                                                        <div class="row-sensor d-flex justify-content-between align-items-start fw-light">\n                                                                            <span>Suhu :</span>\n                                                                            <span>${e.devices[0].awsLastReading.temperature} &#8451;</span>\n                                                                        </div>  \n                                                                        <div class="row-sensor d-flex justify-content-between align-items-start fw-light">\n                                                                            <span>Kelembaban :</span>\n                                                                            <span>${e.devices[0].awsLastReading.humidityStatus} (${e.devices[0].awsLastReading.humidity} %)</span>\n                                                                        </div>  \n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </li>\n                                                    <li class="list-group-item">\n                                                        <div class="row">\n                                                            <div class="col-md-6">\n                                                                <div class="d-flex align-items-center p-2">\n                                                                    <img src="/images/icons/icon-wind.jpeg" class="me-2" height="35" alt="Rainfall Icon">\n                                                                    <div class="w-100">\n                                                                        <div class="row-sensor d-flex justify-content-between align-items-start fw-light">\n                                                                            <span>Kecepatan Angin :</span>\n                                                                            <span>${e.devices[0].awsLastReading.windSpeed} Km/jam</span>\n                                                                        </div>  \n                                                                        <div class="row-sensor d-flex justify-content-between align-items-start fw-light">\n                                                                            <span>Arah Angin :</span>\n                                                                            <span><i class="fe-arrow-right me-1"></i> ${e.devices[0].awsLastReading.windDirectionStatus} (${e.devices[0].awsLastReading.windDirection}°)</span>\n                                                                        </div>  \n                                                                        <div class="row-sensor d-flex justify-content-between align-items-start fw-light">\n                                                                            <span>Tekanan Udara :</span>\n                                                                            <span>${e.devices[0].awsLastReading.pressure} mb</span>\n                                                                        </div>  \n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                            <div class="col-md-6">\n                                                                <div class="p-2">\n                                                                    <div class="row-sensor d-flex justify-content-between align-items-center fw-light">\n                                                                        <span><i class="fe-sun icon-sensor text-warning me-1"></i> Radiasi Matahari :</span>\n                                                                        <span>${e.devices[0].awsLastReading.solarRadiation} W/m<sup>2</sup></span>\n                                                                    </div>  \n                                                                    <div class="row-sensor d-flex justify-content-between align-items-center fw-light">\n                                                                        <span><i class="fe-sunrise icon-sensor me-1"></i> Penguapan :</span>\n                                                                        <span>${e.devices[0].awsLastReading.evaporation} mm</sup></span>\n                                                                    </div> \n                                                                    <div class="row-sensor d-flex justify-content-between align-items-center fw-light">\n                                                                        <span><i class="fe-battery-charging icon-sensor me-1"></i> Baterai :</span>\n                                                                        <span>${e.devices[0].awsLastReading.volt} Volt</span>\n                                                                    </div>   \n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </li>\n                                                </ul>\n                                            </div>\n                                        </div>`;document.getElementById("aws-"+e.id)?$("#aws"+e.id).html(y):$("#group-aws").append(`<div class="card-station" onclick="loadStationDetailCard(this, event)" id="aws-${e.id}">\n                                                    ${y}\n                                                </div>`),markerIcon=L.icon({iconUrl:"/assets/images/marker-aws-icon.png",iconSize:[32,43],popupAnchor:[0,-15]}),contentPopup=`<div class="table-responsive mb-2">\n                                            <table class="table table-sm mb-0">\n                                                <thead class="table-light">\n                                                    <tr>\n                                                        <th>Sensor</th>\n                                                        <th>Nilai</th>\n                                                        <th>Intensitas</th>\n                                                    </tr>\n                                                </thead>\n                                                <tbody>\n                                                    <tr>\n                                                        <td><strong>Curah Hujan</strong> (mm)</td>\n                                                        <td class="text-center fw-bold">${g}</td>\n                                                        <td class="text-center fw-bold">${p}</td>\n                                                    </tr>\n                                                </tbody>\n                                            </table>\n                                        </div>`,0}markerIcon=L.divIcon({iconSize:new L.Point(40,20),iconAnchor:new L.Point(20,20),html:`<div class="ts-marker-wrapper"><a href="javascript:void(0)" class="ts-marker ts-arr" data-ts-id="64" data-ts-ln="60" style="outline: none;"><div class="ts-marker__title">${e.name}</div><div class="ts-marker__feature ts-marker__feature__red"><i class="wi wi-day-cloudy-gusts"></i></div></a></div>`})}popup=L.popup({maxWidth:500}).setContent(`\n                                <div class="d-flex justify-content-start mb-2">\n                                    <div class="image-container">\n                                        <a href="/images/default-image.png" class="image-popup" title="${e.name}" id="detail_image_url" style="cursor: zoom-in;">\n                                            <img src="/images/default-image.png" class="rounded avatar-md" alt="${e.name}" id="detail_image">\n                                        </a>\n                                    </div>\n                                    \n                                    <div class="px-2">\n                                        <h5 class="card-title mb-1">${e.name}</h5>\n                                        <span class="badge badge-outline-secondary mb-1" style="align-self: flex-start;">${e.devices[0].brand.name} - ${e.devices[0].deviceId}</span>\n                                    </div>\n                                </div>\n                                <p class="card-text mt-0 mb-1 text-center"><span class="text-muted"><i class="fe-calendar"></i> ${n}</span></p>\n                                ${contentPopup}\n                                <a href="/StationDetail/Index/${e.id}" class="btn btn-sm btn-blue rounded-pill w-100"><i class="fe-eye"></i> Lihat Detail</a>\n                            `),L.marker(new L.LatLng(e.latitude,e.longitude),{icon:markerIcon},{title:e.name}).bindPopup(popup).addTo(map)}}),0}},error:function(a,e,n){}})};return{init:function(){!function(){$("#group-awlr, #group-arr").hide(),$("#group-awlr-shimmer, #group-arr-shimmer").show();L.mapboxGL({accessToken:"pk.eyJ1IjoiaGFuZHlhc3dhbiIsImEiOiJjbDY3YmNmcGgwODAxM2R0YjZzY3ZkN3M5In0.7aDstmvWZvOmZIwyPfMB4g",style:"mapbox://styles/mapbox/streets-v11"}).addTo(map);map.removeControl(map.zoomControl);const a=L.control({position:"bottomright"});a.onAdd=function(a){const e=L.DomUtil.create("div","info legend"),n=[];return n.push('<div class="mb-1"><i class="das" style="background: #CD30B2;"></i> Batas DAS</div>'),n.push('<div class="mb-1"><i class="fas fa-water icon-round-legend round-pda-legend"></i> Pos Duga Air</div>'),n.push('<div class="mb-1"><i class="wi wi-sleet icon-round-legend round-pch-legend"></i> Pos Curah Hujan</div>'),e.innerHTML=n.join(""),e},a.addTo(map);var e=L.control.layers(null,null,{position:"bottomright"}).addTo(map);$.getJSON("/data/das_kapuas.json",function(a){L.geoJson(a,{style:function(a){return{weight:1,color:"#CD30B2",fillColor:"transparent",fillOpacity:.2}},onEachFeature:function(a,n){null!=a.properties.NAMA_DAS&&(n.bindTooltip(a.properties.NAMA_DAS,{direction:"center",permanent:!1,opacity:.75,className:"leaflet-tooltip-own"}).openTooltip(),e.addOverlay(n,a.properties.NAMA_DAS))}}).addTo(map)}),$.getJSON("data/sungai_kapuas.json",function(a){L.geoJson(a,{style:function(a){return{weight:.8,color:"#28B0E7"}},onEachFeature:function(a,e){a.properties.NAMA_SUNGA}}).addTo(map)}),L.control.zoom({position:"bottomright"}).addTo(map)}(),a(),setInterval(a,3e5)}}}();function getIntensityIcon(a){let e="";switch(a){case"Berawan":e="berawan-siang.png";break;case"Hujan Ringan":e="hujan-ringan.png";break;case"Hujan Sedang":e="hujan-sedang.png";break;case"Hujan Lebat":e="hujan-lebat.png";break;case"Hujan Sangat Lebat":e="hujan-sangat-lebat.png"}return e}function getIntensityCircle(a){let e="";switch(a){case"Berawan":e="circle-berawan";break;case"Hujan Ringan":e="circle-hujan-ringan";break;case"Hujan Sedang":e="circle-hujan-sedang";break;case"Hujan Lebat":e="circle-hujan-lebat";break;case"Hujan Sangat Lebat":e="circle-hujan-sangat-lebat"}return e}function getLevelStatusCircle(a){let e="";switch(a){case"Normal":e="circle-normal";break;case"Siaga 3":e="circle-siaga-3";break;case"Siaga 2":e="circle-siaga-2";break;case"Siaga 1":e="circle-siaga-1"}return e}function loadStationDetail(a,e){$(a).data("id")}jQuery(document).ready(function(){RealtimeMonitoringSystem.init()});