"use strict";var dataTableHulu,dataHulu={init:function(){$("#Nilai").val(0),$(".parsley-validation").parsley(),$("#search-hulu-table").keyup(function(){dataTableHulu.search($(this).val()).draw()}),$("#length-hulu-table").change(function(){dataTableHulu.page.len($(this).val()).draw()}),(dataTableHulu=$("#table-hulu").DataTable({processing:!0,serverSide:!0,dom:"tipr",order:[[2,"asc"]],ajax:{url:"/DebitBendung/GetDataDebitHulu",type:"POST",dataType:"JSON"},columns:[{data:null},{data:"tanggal",name:"Tanggal",render:function(a){return formatDate(a,"tanggal")}},{data:"nilai",name:"Nilai",render:function(a){return a?`<span class="ketersediaan-color fw-semibold text-center d-block">${parseFloat(a).toFixed(2)}</span>`:'<span class="text-center d-block">-</span>'}},{data:"satuan",name:"Satuan",className:"text-center"},{data:"nilai_sidareja",name:"Nilai Sidareja",render:function(a){return a?`<span class="ketersediaan-color fw-semibold text-center d-block">${parseFloat(a).toFixed(2)}</span>`:'<span class="text-center d-block">-</span>'}},{data:"nilai_cihaur",name:"Nilai Cihaur",render:function(a){return a?`<span class="ketersediaan-color fw-semibold text-center d-block">${parseFloat(a).toFixed(2)}</span>`:'<span class="text-center d-block">-</span>'}},{data:"nilai_lakbok",name:"Nilai lakbok",render:function(a){return a?`<span class="ketersediaan-color fw-semibold text-center d-block">${parseFloat(a).toFixed(2)}</span>`:'<span class="text-center d-block">-</span>'}},{data:"update",name:"Update",render:function(a){return formatDate(a,"update")}},{className:"text-nowrap",render:function(a,e,t){return`<button type="button" class="btn btn-xs btn-success me-1 rounded-2 action-button" data-id="${t.id}" onclick="createEditDebit(this, event)"><i class="mdi mdi-square-edit-outline me-1"></i>Edit</button>\n                            <button type="button" class="btn btn-xs btn-danger rounded-2" data-id="${t.id}" onclick="deleteDebit(this, event)"><i class="mdi mdi-delete me-1"></i>Delete</button>`}}],columnDefs:[{targets:0,searchable:!1,orderable:!1,width:"9%",className:"text-center"},{targets:-1,searchable:!1,orderable:!1,width:"18%",className:"text-center"}],language:{paginate:{previous:"<i class='mdi mdi-chevron-left'>",next:"<i class='mdi mdi-chevron-right'>"}},drawCallback:function(){$(".dataTables_paginate > .pagination").addClass("pagination-rounded")}})).on("draw.dt",function(){var a=dataTableHulu.page.info();dataTableHulu.column(0,{search:"applied",order:"applied",page:"applied"}).nodes().each(function(e,t){e.innerHTML=t+1+a.start})})}};function formatDate(a,e){const t=new Date(a),n=t.getDate(),i=["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"][t.getMonth()],l=t.getFullYear(),r=String(t.getHours()).padStart(2,"0"),o=String(t.getMinutes()).padStart(2,"0");return"tanggal"===e?`${n} ${i} ${l}`:"update"===e?`${n} ${i} ${l} ${r}:${o}`:void 0}function calculate(){let a=0,e=0,t=0;a=document.getElementById("nilai_sidareja").value?document.getElementById("nilai_sidareja").value:0,e=document.getElementById("nilai_cihaur").value?document.getElementById("nilai_cihaur").value:0,t=document.getElementById("nilai_lakbok").value?document.getElementById("nilai_lakbok").value:0;var n=+parseFloat(a)+parseFloat(e)+parseFloat(t);document.getElementById("Nilai").value=parseFloat(n).toFixed(2),$("#Nilai").val(n)}jQuery(document).ready(function(){dataHulu.init(),$("#nilai_sidareja").on("input",function(){calculate(),console.log("nilai_sidareja")}),$("#input-hulu").on("submit",function(a){a.preventDefault();var e=$(this).find('button[type="submit"]'),t=e.text(),n=($(this).serialize(),new FormData(this));for(var i of n.entries())console.log(i[0]+": "+i[1]);e.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Loading...'),$.ajax({url:"/DebitBendung/SaveHulu",type:"POST",data:$(this).serialize(),success:function(a){200==a.code?($("#input-hulu")[0].reset(),dataTableHulu.ajax.reload(null,!1)):alert("There was an error submitting the form.")},error:function(a,e,t){console.error("Submission failed:",t),alert("An error occurred while submitting the form.")},complete:function(){e.prop("disabled",!1).html(t)}})})}),window.createEditDebit=((a,e)=>{e.preventDefault(),console.log(a);var t=$(a).html();beforeLoadingButton($(a));var n=$(a).data("id"),i=new FormData;i.append("Id",n),postData("/DebitBendung/CreateEditHulu",i).then(e=>{let n=e.data;$("#modalCreateEditDebit .modal-content").html(n),$("#modalCreateEditDebit").modal("show"),afterLoadingButton($(a),t)})}),window.updateHulu=((a,e)=>{console.log(a),e.preventDefault();var t=$(a).find("button[type=submit]");if($(a).parsley().validate(),$(a).parsley().isValid()){beforeLoadingButton(t);var n=new FormData;n.append("Id",$(a).find("input[name='Id']").val()),n.append("Nilai",$(a).find("input[name='Nilai']").val()),n.append("Satuan",$(a).find("input[name='Satuan']").val()),n.append("NilaiSidareja",$(a).find("input[name='NilaiSidareja']").val()),n.append("NilaiCihaur",$(a).find("input[name='NilaiCihaur']").val()),n.append("NilaiLakbok",$(a).find("input[name='NilaiLakbok']").val()),postData("/DebitBendung/UpdateHulu",n).then(a=>{let e=a.data;200==e.code?(console.log("suskes"),$("#modalCreateEditDebit").modal("hide"),dataTableHulu.ajax.reload(null,!1)):showMessage("error","Gagal!",e.message),afterLoadingButton(t)}).catch(a=>{console.log(a),afterLoadingButton(t)})}}),window.deleteDebit=((a,e)=>{e.preventDefault();var t=$(a).data("id");Swal.fire({title:"Hapus Debit",text:"Anda yakin untuk menghapus Debit tersebut ?",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Ya, Hapus",cancelButtonText:"Batal",showLoaderOnConfirm:!0,preConfirm:()=>deleteData("/DebitBendung/DeleteHulu/"+t).then(a=>{if(200!==a.status)throw new Error(a.statusText);return a}).catch(a=>{Swal.showValidationMessage(`Request failed: ${a}`)}),allowOutsideClick:()=>!Swal.isLoading()}).then(a=>{console.log(a),a.isConfirmed&&(200==a.value.data.code?dataTableHulu.ajax.reload(null,!1):showMessage("error","Failed",a.value.data.message))})});