"use strict";let markers;var load_markers=[];let contentPopup,markerIcon,popup;var map=L.map("ts-map-hero",{maxZoom:17}).setView([-6.3764087,106.508455],10),RealtimeMonitoringSystem={init:function(){!function(){L.mapboxGL({accessToken:"pk.eyJ1IjoiaGFuZHlhc3dhbiIsImEiOiJjbDY3YmNmcGgwODAxM2R0YjZzY3ZkN3M5In0.7aDstmvWZvOmZIwyPfMB4g",style:"mapbox://styles/mapbox/streets-v11"}).addTo(map),map.removeControl(map.zoomControl);const a=L.control({position:"bottomright"});a.onAdd=function(a){const e=L.DomUtil.create("div","info legend"),t=[];return t.push('<div class="mb-1"><i class="das" style="background: #3388FF;"></i> Batas DAS</div>'),t.push('<div class="mb-1"><i class="fa fa-map-marker icon-round-legend round-pda-legend"></i> Pos Duga Air</div>'),t.push('<div class="mb-1"><i class="fa fa-map-marker icon-round-legend round-pch-legend"></i> Pos Curah Hujan</div>'),e.innerHTML=t.join(""),e},a.addTo(map);var e=L.control.layers(null,null,{position:"bottomright"}).addTo(map);$.getJSON("/data/das_ciliwung.json",function(a){L.geoJson(a,{style:function(a){return{weight:2,color:"#CD30B2",fillColor:"transparent",fillOpacity:.2}},onEachFeature:function(a,t){null!=a.properties.NAMA_DAS&&(t.bindTooltip(a.properties.NAMA_DAS,{direction:"center",permanent:!1,opacity:.75,className:"leaflet-tooltip-own"}).openTooltip(),e.addOverlay(t,a.properties.NAMA_DAS))}}).addTo(map)}),$.getJSON("data/sungai_ciliwung_cisadane.json",function(a){L.geoJson(a,{style:function(a){return{weight:.8,color:"#0089F7"}},onEachFeature:function(a,e){a.properties.NAMA_SUNGA}}).addTo(map)}),L.control.zoom({position:"bottomright"}).addTo(map)}(),$.ajax({url:"Reading/GetLastReading",type:"GET",dataType:"JSON",beforeSend:function(){},success:function(a){if(a.length>0){var e=0,t=0;$.each(a,function(a,n){let i="",s="",l="",r="",d="bg-awlr-normal",o="",c="",m="",p="",g="",v="",u=" <p>-</p>";if(n.devices.length>0){switch(contentPopup="",n.type){case"AWLR":if(null!=n.devices[0].awlrLastReading){switch(null!=n.devices[0].awlrLastReading.waterLevel&&(o=n.devices[0].awlrLastReading.waterLevel),null!=n.devices[0].awlrLastReading.waterLevelMin&&(c=n.devices[0].awlrLastReading.waterLevelMin),null!=n.devices[0].awlrLastReading.waterLevelMax&&(m=n.devices[0].awlrLastReading.waterLevelMax),i=null==n.devices[0].awlrLastReading.readingAt?"Data tidak tersedia":`${s=moment(n.devices[0].awlrLastReading.readingAt).locale("id").format("dddd, D MMMM YYYY")} <small class="text-muted">${l=moment(n.devices[0].awlrLastReading.readingAt).locale("id").format("HH:mm")} WIB</small>`,null!=n.devices[0].awlrSetting&&null!=n.devices[0].siaga1&&null!=n.devices[0].siaga2&&null!=n.devices[0].siaga3&&(r=`<div class="progress-meter">\n                                                    <div class="meter meter-normal meter-left" style="width: 25%;" title="Normal <br> < ${n.awlr_setting.level1} m" tabindex="0" data-plugin="tippy" data-tippy-followCursor="true" data-tippy-arrow="true" data-tippy-animation="fade"><span class="meter-text">0</span></div>\n                                                    <div class="meter meter-waspada meter-left" style="width: 25%;" title="Siaga 3 <br> ${n.awlr_setting.level1} m - ${n.awlr_setting.level2} m" tabindex="0" data-plugin="tippy" data-tippy-followCursor="true" data-tippy-arrow="true" data-tippy-animation="fade"><span class="meter-text">${n.awlr_setting.level1} m</span></div>\n                                                    <div class="meter meter-siaga meter-left" style="width: 25%;" title="Siaga 2 <br> ${n.awlr_setting.level2} m - ${n.awlr_setting.level3} m" tabindex="0" data-plugin="tippy" data-tippy-followCursor="true" data-tippy-arrow="true" data-tippy-animation="fade"><span class="meter-text">${n.awlr_setting.level2} m</span></div>\n                                                    <div class="meter meter-awas meter-left" style="width: 25%;" title="Siaga 1 <br> > ${n.awlr_setting.level3} m" tabindex="0" data-plugin="tippy" data-tippy-followCursor="true" data-tippy-arrow="true" data-tippy-animation="fade"><span class="meter-text">${n.awlr_setting.level3} m</span></div>\n                                                </div>`),n.devices[0].awlrLastReading.wlStatus){case"Normal":d="bg-awlr-normal";break;case"Siaga 3":d="bg-awlr-siaga3";break;case"Siaga 2":d="bg-awlr-siaga2";break;case"Siaga 1":d="bg-awlr-siaga1";break;default:d="bg-awlr-normal"}switch(n.devices[0].awlrLastReading.changeStatus){case"increase":p=`<p class="text-change-status">\n                                                    <span class="text-danger font-10" style="margin-right: 1px;">▲</span>\n                                                    <span class="fst-italic text-danger fw-bold font-12"> +${n.devices[0].awlrLastReading.changeValue} m</span>\n                                                </p>`;break;case"decrease":p=`<p class="text-change-status">\n                                                    <span class="font-10" style="color: #3B883E;margin-right: 1px;-webkit-transform: rotate(180deg);transform: rotate(180deg);display: inline-block;">▲</span>\n                                                    <span class="fst-italic fw-bold font-12" style="color: #3B883E;">${n.devices[0].awlrLastReading.changeValue} m</span>\n                                                </p>`}var b="-";null!=n.devices[0].awlrLastReading.debit&&(b=n.devices[0].awlrLastReading.debit);var f=`<div class="card content-logger mb-1">\n                                            <div class="row no-gutters">\n                                                <div class="col-sm-3 content-sensor ${d} d-flex text-center">\n                                                    <div class="justify-content-center align-self-center w-100">\n                                                        <h4>${""==o?"-":o+" m"}</h4>\n                                                        ${p}\n                                                    </div>\n                                                </div>\n                                                <div class="col-sm-9">\n                                                    <div class="card-body content-station pt-2">\n                                                        <div class="row">\n                                                            <div class="col-9">\n                                                                <h6 class="mb-1 mt-0 me-1">${n.name}</h6>\n                                                                <p class="card-text">${i}</p>\n                                                                ${r}\n                                                            </div>\n                                                            <div class="col-3">\n                                                                <div class="circle-tma" style="width: 3.4rem;height: 3.4rem;border: 4px solid rgba(0, 0, 0, .2); border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center;">\n                                                                    <span style="display: block; font-size: 1.3rem; font-weight: 700;"> ${b}</span>\n                                                                    <span style="display: block; font-size: 0.7rem; font-weight: 400;"> m<sup>3</sup>/s</span>\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>`;document.getElementById("awlr-"+n.id)?$("#awlr"+n.id).html(f):$("#group-awlr").append(`<div class="card-station" data-id="${n.id}" onclick="loadStationDetailCard(this, event)" id="awlr-${n.id}">\n                                                    ${f}\n                                                </div>`),markerIcon=L.icon({iconUrl:"/assets/images/marker-awlr-icon.png",iconSize:[32,43],popupAnchor:[0,-15]}),contentPopup=`<div class="table-responsive mb-2">\n                                            <table class="table table-sm mb-0">\n                                                <thead class="table-light">\n                                                    <tr>\n                                                        <th>Sensor</th>\n                                                        <th>Nilai</th>\n                                                        <th>Min</th>\n                                                        <th>Max</th>\n                                                    </tr>\n                                                </thead>\n                                                <tbody>\n                                                    <tr>\n                                                        <td><strong>Tinggi Muka Air</strong> (m)</td>\n                                                        <td class="text-center fw-bold">${o}</td>\n                                                        <td class="text-center fw-bold">${c}</td>\n                                                        <td class="text-center fw-bold">${m}</td>\n                                                    </tr>\n                                                </tbody>\n                                            </table>\n                                        </div>`,e++}markerIcon=L.divIcon({iconSize:new L.Point(40,20),iconAnchor:new L.Point(20,20),html:`<div class="ts-marker-wrapper"><a href="javascript:void(0)" class="ts-marker ts-awlr" data-ts-id="64" data-ts-ln="60" style="outline: none;"><div class="ts-marker__title">${n.name}</div><div class="ts-marker__feature ts-marker__feature__blue ${n.status}"><i class="fa fa-map-marker"></i></div></a></div>`});break;case"ARR":if(null!=n.devices[0].arrLastReading){var w='<div class="col-sm-3 content-sensor bg-no-data d-flex text-center">\n                                            <div class="justify-content-center align-self-center w-100">\n                                                <h4>-</h4>\n                                            </div>\n                                        </div>';null!=n.devices[0].arrLastReading.rainfallHour&&(v=n.devices[0].arrLastReading.rainfallHour),i=null==n.devices[0].arrLastReading.readingAt?"Data tidak tersedia":`${s=moment(n.devices[0].arrLastReading.readingAt).locale("id").format("dddd, D MMMM YYYY")} <small class="text-muted">${l=moment(n.devices[0].arrLastReading.readingAt).locale("id").format("HH:00")} WIB</small>`,null!=n.devices[0].arrLastReading.intensityHour&&(w=`<div class="col-sm-3 content-sensor bg-arr">\n                                                <div class="d-flex text-center bg-arr-am">\n                                                    <div class="justify-content-center align-self-center w-100">\n                                                        ${u=`<img src="/images/intensity/${getIntensityIcon(g=n.devices[0].arrLastReading.intensityHour)}" alt="${g}">\n                                                <p class="text-intensity">${g}</p>`}\n                                                    </div>\n                                                </div>\n                                            </div>`);var h=`<div class="card content-logger mb-1">\n                                            <div class="card-body p-0">\n                                                <div class="row no-gutters">\n                                                    ${w}\n                                                    <div class="col-sm-9">\n                                                        <div class="content-station">\n                                                            <div class="row">\n                                                                <div class="col-9">\n                                                                    <h6 class="mb-1 mt-0 me-1">${n.name}</h6>\n                                                                    <p class="card-text">${i}</p>\n                                                                </div>\n                                                                <div class="col-3">\n                                                                    <div class="circle-tma" style="width: 3.4rem;height: 3.4rem;border: 4px solid rgba(0, 0, 0, .2); border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center;">\n                                                                        <span style="display: block; font-size: 1.3rem; font-weight: 700;"> ${v}</span>\n                                                                        <span style="display: block; font-size: 0.7rem; font-weight: 400;"> mm</span>\n                                                                    </div>\n                                                                </div>\n                                                            </div>\n                                                        </div>\n                                                    </div>\n                                                </div>\n                                            </div>\n                                        </div>`;document.getElementById("arr-"+n.id)?$("#arr"+n.id).html(h):$("#group-arr").append(`<div class="card-station" data-id="${n.id}" onclick="loadStationDetailCard(this, event)" id="arr-${n.id}">\n                                                    ${h}\n                                                </div>`),markerIcon=L.icon({iconUrl:"/assets/images/marker-arr-icon.png",iconSize:[32,43],popupAnchor:[0,-15]}),contentPopup=`<div class="table-responsive mb-2">\n                                            <table class="table table-sm mb-0">\n                                                <thead class="table-light">\n                                                    <tr>\n                                                        <th>Sensor</th>\n                                                        <th>Nilai</th>\n                                                        <th>Intensitas</th>\n                                                    </tr>\n                                                </thead>\n                                                <tbody>\n                                                    <tr>\n                                                        <td><strong>Curah Hujan</strong> (mm)</td>\n                                                        <td class="text-center fw-bold">${v}</td>\n                                                        <td class="text-center fw-bold">${g}</td>\n                                                    </tr>\n                                                </tbody>\n                                            </table>\n                                        </div>`,t++}markerIcon=L.divIcon({iconSize:new L.Point(40,20),iconAnchor:new L.Point(20,20),html:`<div class="ts-marker-wrapper"><a href="javascript:void(0)" class="ts-marker ts-arr" data-ts-id="64" data-ts-ln="60" style="outline: none;"><div class="ts-marker__title">${n.name}</div><div class="ts-marker__feature ts-marker__feature__green"><i class="fa fa-map-marker"></i></div></a></div>`})}popup=L.popup({maxWidth:500}).setContent(`\n                                <div class="d-flex justify-content-start mb-2">\n                                    <div class="image-container">\n                                        <a href="/images/default-image.png" class="image-popup" title="${n.name}" id="detail_image_url" style="cursor: zoom-in;">\n                                            <img src="/images/default-image.png" class="rounded avatar-md" alt="${n.name}" id="detail_image">\n                                        </a>\n                                    </div>\n                                    \n                                    <div class="px-2">\n                                        <h5 class="card-title mb-1">${n.name}</h5>\n                                        <span class="badge badge-outline-secondary mb-1" style="align-self: flex-start;">${n.devices[0].brand.name} - ${n.devices[0].deviceId}</span>\n                                    </div>\n                                </div>\n                                <p class="card-text mt-0 mb-1 text-center"><small class="text-muted"><i class="fe-calendar"></i> ${i}</small></p>\n                                ${contentPopup}\n                                <button type="button" class="btn btn-sm btn-blue w-100" data-id="${n.id}" onclick="loadStationDetail(this, event)"><i class="fa fa-search"></i> Lihat Detail</button>\n                            `),L.marker(new L.LatLng(n.latitude,n.longitude),{icon:markerIcon},{title:n.name}).bindPopup(popup).addTo(map)}}),$("#running-text").html(""),$("#total-awlr").text(e),$("#total-arr").text(t)}},error:function(a,e,t){}})}};function getIntensityIcon(a){let e="";switch(a){case"Berawan":e="berawan.png";break;case"Hujan Ringan":e="hujan-ringan.png";break;case"Hujan Sedang":e="hujan-sedang.png";break;case"Hujan Lebat":e="hujan-lebat.png";break;case"Hujan Sangat Lebat":e="hujan-sangat-lebat.png"}return e}jQuery(document).ready(function(){RealtimeMonitoringSystem.init()});